import{s as j}from"./check_box.j.46b9e12f.js";import{T as q}from"./text_box.67135b71.js";import{a as D,D as J,$ as g,J as x,e as u,a1 as T,K as Q,aZ as Z,m as O,o as C,V as p,L as S,Y as ee,aE as te,d as H,af as re,r as U,Q as w,g as X,y as ae,A as ie,B as se,as as le,at as oe,p as ne,ak as ge}from"./index.ab648286.js";import{U as A,W as P,T as m,a9 as he,bB as ce,$,bC as de,ak as V,bD as _e,Y as L,af as N,ab as R}from"./entry.d8c3daa0.js";import{t as ve}from"./ui.collection_widget.edit.f359a828.js";j.setEditorClass(q);var z=X(),fe="keydown",E="dxDraggable",ue=D(ae,E),pe=D(ie,E),me=D(se,E),Ee=D(le,E),be=D(oe,E),Se=D(ne.down,E),De=D(fe,E),k="clone",y,I,Ie="content",M=e=>({x:e.pageX-g(z).scrollLeft(),y:e.pageY-g(z).scrollTop()}),Ae="dx-gesture-cover",Te="dx-overlay-wrapper",xe="dx-overlay-content";class W{constructor(t,r){this._$scrollableAtPointer=null,this._preventScroll=!0,this._component=r,t==="vertical"?(this._scrollValue="scrollTop",this._overFlowAttr="overflowY",this._sizeAttr="height",this._scrollSizeProp="scrollHeight",this._clientSizeProp="clientHeight",this._limitProps={start:"top",end:"bottom"}):(this._scrollValue="scrollLeft",this._overFlowAttr="overflowX",this._sizeAttr="width",this._scrollSizeProp="scrollWidth",this._clientSizeProp="clientWidth",this._limitProps={start:"left",end:"right"})}updateScrollable(t,r){var a=!1;t.some(i=>{var s=g(i),l=s.hasClass(Te),o=s.hasClass(xe);return l||o?!0:(a=this._trySetScrollable(i,r),a)}),a||(this._$scrollableAtPointer=null,this._scrollSpeed=0)}isScrolling(){return!!this._scrollSpeed}isScrollable(t){return(t.css(this._overFlowAttr)==="auto"||t.hasClass("dx-scrollable-container"))&&t.prop(this._scrollSizeProp)>Math.ceil(this._sizeAttr==="width"?O(t):C(t))}_trySetScrollable(t,r){var a=g(t),i,s=this._component.option("scrollSensitivity"),l=this.isScrollable(a);return l&&(i=this._calculateDistanceToBorders(a,r),s>i[this._limitProps.start]?this._preventScroll||(this._scrollSpeed=-this._calculateScrollSpeed(i[this._limitProps.start]),this._$scrollableAtPointer=a):s>i[this._limitProps.end]?this._preventScroll||(this._scrollSpeed=this._calculateScrollSpeed(i[this._limitProps.end]),this._$scrollableAtPointer=a):(l=!1,this._preventScroll=!1)),l}_calculateDistanceToBorders(t,r){var a=t.get(0),i;return a?(i=w(a),{left:r.x-i.left,top:r.y-i.top,right:i.right-r.x,bottom:i.bottom-r.y}):{}}_calculateScrollSpeed(t){var r=this._component,a=r.option("scrollSensitivity"),i=r.option("scrollSpeed");return Math.ceil(Math.pow((a-t)/a,2)*i)}scrollByStep(){if(this._$scrollableAtPointer&&this._scrollSpeed){if(this._$scrollableAtPointer.hasClass("dx-scrollable-container")){var t=this._$scrollableAtPointer.closest(".dx-scrollable"),r=t.data("dxScrollable")||t.data("dxScrollView");if(r){var a=r.scrollOffset()[this._limitProps.start]+this._scrollSpeed;r.scrollTo({[this._limitProps.start]:a})}}else{var i=this._$scrollableAtPointer[this._scrollValue]()+this._scrollSpeed;this._$scrollableAtPointer[this._scrollValue](i)}var s=this._component._dragMoveArgs;s&&this._component._dragMoveHandler(s)}}reset(){this._$scrollableAtPointer=null,this._scrollSpeed=0,this._preventScroll=!0}isOutsideScrollable(t,r){if(!t)return!1;var a=w(t.get(0)),i=a[this._limitProps.start],s=a[this._sizeAttr],l=M(r),o=this._sizeAttr==="width"?l.x:l.y;return o<i||o>i+s}}var Oe=ve.inherit({ctor(e){this.callBase(),this._strategy=e},_step(){var e=this._strategy._horizontalScrollHelper,t=this._strategy._verticalScrollHelper;e&&e.scrollByStep(),t&&t.scrollByStep()}}),K=J.inherit({reset:A,dragMove:A,dragEnter:A,dragLeave:A,dragEnd(e){var t=this._getSourceDraggable();return t._fireRemoveEvent(e),P().resolve()},_fireRemoveEvent:A,_getDefaultOptions(){return m(this.callBase(),{onDragStart:null,onDragMove:null,onDragEnd:null,onDragEnter:null,onDragLeave:null,onDragCancel:null,onCancelByEsc:!1,onDrop:null,immediate:!0,dragDirection:"both",boundary:void 0,boundOffset:0,allowMoveByClick:!1,itemData:null,container:void 0,dragTemplate:void 0,contentTemplate:"content",handle:"",filter:"",clone:!1,autoScroll:!0,scrollSpeed:30,scrollSensitivity:60,group:void 0,data:void 0})},_setOptionsByReference(){this.callBase.apply(this,arguments),m(this._optionsByReference,{component:!0,group:!0,itemData:!0,data:!0})},_init(){this.callBase(),this._attachEventHandlers(),this._scrollAnimator=new Oe(this),this._horizontalScrollHelper=new W("horizontal",this),this._verticalScrollHelper=new W("vertical",this),this._initScrollTop=0,this._initScrollLeft=0},_normalizeCursorOffset(e){return he(e)&&(e={h:e.x,v:e.y}),e=ce(e).map(t=>parseFloat(t)),{left:e[0],top:e.length===1?e[0]:e[1]}},_getNormalizedCursorOffset(e,t){return $(e)&&(e=e.call(this,t)),this._normalizeCursorOffset(e)},_calculateElementOffset(e){var t,r,{event:a}=e,i=g(e.itemElement),s=g(e.dragElement),l=this._dragElementIsCloned(),o=this.option("cursorOffset"),n={left:0,top:0},h=this._initialLocate=x(s);return(l||e.initialOffset||o)&&(t=e.initialOffset||i.offset(),o&&(n=this._getNormalizedCursorOffset(o,e),isFinite(n.left)&&(t.left=a.pageX),isFinite(n.top)&&(t.top=a.pageY)),r=s.offset(),t.top-=r.top+(n.top||0)-h.top,t.left-=r.left+(n.left||0)-h.left),t},_initPosition(e){var t=g(e.dragElement),r=this._calculateElementOffset(e);r&&this._move(r,t),this._startPosition=x(t)},_startAnimator(){this._scrollAnimator.inProgress()||this._scrollAnimator.start()},_stopAnimator(){this._scrollAnimator.stop()},_addWidgetPrefix(e){var t=this.NAME;return de(t)+(e?"-".concat(e):"")},_getItemsSelector(){return this.option("filter")||""},_$content(){var e=this.$element(),t=e.children(".dx-template-wrapper");return t.length?t:e},_attachEventHandlers(){if(!this.option("disabled")){var e=this._$content(),t=this._getItemsSelector(),r=this.option("allowMoveByClick"),a={direction:this.option("dragDirection"),immediate:this.option("immediate"),checkDropTarget:(i,s)=>{var l=this.option("group"),o=this._getSourceDraggable().option("group"),n=this._getScrollable(i);return this._verticalScrollHelper.isOutsideScrollable(n,s)||this._horizontalScrollHelper.isOutsideScrollable(n,s)?!1:o&&o===l}};r&&(e=this._getArea(),u.on(e,Se,a,this._pointerDownHandler.bind(this))),t[0]===">"&&(t=t.slice(1)),u.on(e,ue,t,a,this._dragStartHandler.bind(this)),u.on(e,pe,a,this._dragMoveHandler.bind(this)),u.on(e,me,a,this._dragEndHandler.bind(this)),u.on(e,Ee,a,this._dragEnterHandler.bind(this)),u.on(e,be,a,this._dragLeaveHandler.bind(this)),this.option("onCancelByEsc")&&u.on(e,De,this._keydownHandler.bind(this))}},_dragElementIsCloned(){return this._$dragElement&&this._$dragElement.hasClass(this._addWidgetPrefix(k))},_getDragTemplateArgs(e,t){return{container:T(t),model:{itemData:this.option("itemData"),itemElement:T(e)}}},_createDragElement(e){var t=e,r=this.option("clone"),a=this._getContainer(),i=this.option("dragTemplate");return i?(i=this._getTemplate(i),t=g("<div>").appendTo(a),i.render(this._getDragTemplateArgs(e,t))):r&&(t=g("<div>").appendTo(a),e.clone().css({width:e.css("width"),height:e.css("height")}).appendTo(t)),t.toggleClass(this._addWidgetPrefix(k),t.get(0)!==e.get(0)).toggleClass("dx-rtl",this.option("rtlEnabled"))},_resetDragElement(){this._dragElementIsCloned()?this._$dragElement.remove():this._toggleDraggingClass(!1),this._$dragElement=null},_resetSourceElement(){this._toggleDragSourceClass(!1),this._$sourceElement=null},_detachEventHandlers(){u.off(this._$content(),".".concat(E)),u.off(this._getArea(),".".concat(E))},_move(e,t){Q(t||this._$dragElement,e)},_getDraggableElement(e){var t=this._getSourceElement();if(t)return t;var r=this.option("allowMoveByClick");if(r)return this.$element();var a=g(e&&e.target),i=this._getItemsSelector();if(i[0]===">"){var s=this._$content().find(i);s.is(a)||(a=a.closest(s))}return a},_getSourceElement(){var e=this._getSourceDraggable();return e._$sourceElement},_pointerDownHandler(e){if(!Z(e)){var t={},r=this.$element(),a=this.option("dragDirection");(a==="horizontal"||a==="both")&&(t.left=e.pageX-r.offset().left+x(r).left-O(r)/2),(a==="vertical"||a==="both")&&(t.top=e.pageY-r.offset().top+x(r).top-C(r)/2),this._move(t,r),this._getAction("onDragMove")(this._getEventArgs(e))}},_isValidElement(e,t){var r=this.option("handle"),a=g(e.originalEvent&&e.originalEvent.target);return r&&!a.closest(r).length||!t.length?!1:!t.is(".dx-state-disabled, .dx-state-disabled *")},_dragStartHandler(e){var t=this._getDraggableElement(e);if(this.dragInProgress=!0,!this._isValidElement(e,t)){e.cancel=!0;return}if(!this._$sourceElement){var r=this._getDragStartArgs(e,t);if(this._getAction("onDragStart")(r),r.cancel){e.cancel=!0;return}this.option("itemData",r.itemData),this._setSourceDraggable(),this._$sourceElement=t;var a=t.offset();!this._hasClonedDraggable()&&this.option("autoScroll")&&(this._initScrollTop=this._getScrollableScrollTop(),this._initScrollLeft=this._getScrollableScrollLeft(),a=this._getDraggableElementOffset(a.left,a.top));var i=this._$dragElement=this._createDragElement(t);this._toggleDraggingClass(!0),this._toggleDragSourceClass(!0),this._setGestureCoverCursor(i.children());var s=i.css("position")==="fixed";this._initPosition(m({},r,{dragElement:i.get(0),initialOffset:s&&a})),this._getAction("onDraggableElementShown")(V(V({},r),{dragElement:i}));var l=this._getArea(),o=this._getAreaOffset(l),n=this._getBoundOffset(),h=p(l),_=S(l),c=O(i),d=C(i),b=i.offset().left-o.left,v=i.offset().top-o.top;l.length&&(e.maxLeftOffset=b-n.left,e.maxRightOffset=h-b-c-n.right,e.maxTopOffset=v-n.top,e.maxBottomOffset=_-v-d-n.bottom),this.option("autoScroll")&&this._startAnimator()}},_getAreaOffset(e){var t=e&&ee.offset(e);return t||{left:0,top:0}},_toggleDraggingClass(e){this._$dragElement&&this._$dragElement.toggleClass(this._addWidgetPrefix("dragging"),e)},_toggleDragSourceClass(e,t){var r=t||this._$sourceElement;r&&r.toggleClass(this._addWidgetPrefix("source"),e)},_setGestureCoverCursor(e){g(".".concat(Ae)).css("cursor",e.css("cursor"))},_getBoundOffset(){var e=this.option("boundOffset");return $(e)&&(e=e.call(this)),_e(e)},_getArea(){var e=this.option("boundary");return $(e)&&(e=e.call(this)),g(e)},_getContainer(){var e=this.option("container");return e===void 0&&(e=te()),g(e)},_getDraggableElementOffset(e,t){var r,a,i,s,l=this._initScrollTop,o=this._initScrollLeft,n=this._getScrollableScrollTop(),h=this._getScrollableScrollLeft(),_=g(this.element()).css("position"),c=_==="fixed",d={left:((a=(r=this._startPosition)===null||r===void 0?void 0:r.left)!==null&&a!==void 0?a:0)+e,top:((s=(i=this._startPosition)===null||i===void 0?void 0:i.top)!==null&&s!==void 0?s:0)+t};return c||this._hasClonedDraggable()?d:{left:L(h)?d.left+h-o:d.left,top:L(n)?d.top+n-l:d.top}},_hasClonedDraggable(){return this.option("clone")||this.option("dragTemplate")},_dragMoveHandler(e){if(this._dragMoveArgs=e,!this._$dragElement){e.cancel=!0;return}var t=this._getDraggableElementOffset(e.offset.x,e.offset.y);this._move(t),this._updateScrollable(e);var r=this._getEventArgs(e);if(this._getAction("onDragMove")(r),r.cancel!==!0){var a=this._getTargetDraggable();a.dragMove(e,scrollBy)}},_updateScrollable(e){if(this.option("autoScroll")){var t=M(e),r=H.elementsFromPoint(t.x,t.y,this.$element().get(0));this._verticalScrollHelper.updateScrollable(r,t),this._horizontalScrollHelper.updateScrollable(r,t)}},_getScrollable(e){var t;return e.parents().toArray().some(r=>{var a=g(r);return this._horizontalScrollHelper.isScrollable(a)||this._verticalScrollHelper.isScrollable(a)?(t=a,!0):!1}),t},_getScrollableScrollTop(){var e,t;return(t=(e=this._getScrollable(g(this.element())))===null||e===void 0?void 0:e.scrollTop())!==null&&t!==void 0?t:0},_getScrollableScrollLeft(){var e,t;return(t=(e=this._getScrollable(g(this.element())))===null||e===void 0?void 0:e.scrollLeft())!==null&&t!==void 0?t:0},_defaultActionArgs(){var e=this.callBase.apply(this,arguments),t=this.option("component");return t&&(e.component=t,e.element=t.element()),e},_getEventArgs(e){var t=this._getSourceDraggable(),r=this._getTargetDraggable();return{event:e,itemData:t.option("itemData"),itemElement:T(t._$sourceElement),fromComponent:t.option("component")||t,toComponent:r.option("component")||r,fromData:t.option("data"),toData:r.option("data")}},_getDragStartArgs(e,t){var r=this._getEventArgs(e);return{event:r.event,itemData:r.itemData,itemElement:t,fromData:r.fromData}},_revertItemToInitialPosition(){!this._dragElementIsCloned()&&this._move(this._initialLocate,this._$sourceElement)},_dragEndHandler(e){var t=P(),r=this._getEventArgs(e),a=this._getEventArgs(e),i=this._getTargetDraggable(),s=!0;this.dragInProgress=!1;try{this._getAction("onDragEnd")(r)}finally{N(R(r.cancel)).done(l=>{if(!l&&(i!==this&&i._getAction("onDrop")(a),!a.cancel)){s=!1,N(R(i.dragEnd(r))).always(t.resolve);return}t.resolve()}).fail(t.resolve),t.done(()=>{s&&this._revertItemToInitialPosition(),this._resetDragOptions(i)})}},_isTargetOverAnotherDraggable(e){var t=this._getSourceDraggable();if(this===t)return!1;var r=t._$dragElement,a=t.$element(),i=this.$element(),s=M(e),l=H.elementsFromPoint(s.x,s.y,this.element()),o=l.filter(c=>{var d=g(c);return d.hasClass(this._addWidgetPrefix())?!d.closest(r).length:!1})[0],n=this._getSourceElement(),h=o===a.get(0),_=g(o).closest(n).length;return!o||o===i.get(0)&&!h&&!_},_dragEnterHandler(e){this._fireDragEnterEvent(e),this._isTargetOverAnotherDraggable(e)&&this._setTargetDraggable();var t=this._getSourceDraggable();t.dragEnter(e)},_dragLeaveHandler(e){this._fireDragLeaveEvent(e),this._resetTargetDraggable(),this!==this._getSourceDraggable()&&this.reset();var t=this._getSourceDraggable();t.dragLeave(e)},_keydownHandler(e){this.dragInProgress&&e.key==="Escape"&&this._keydownEscapeHandler(e)},_keydownEscapeHandler(e){var t=this._getSourceElement();if(t){var r=this._getEventArgs(e);if(this._getAction("onDragCancel")(r),!r.cancel){this.dragInProgress=!1,I==null||I._toggleDraggingClass(!1),this._detachEventHandlers(),this._revertItemToInitialPosition();var a=this._getTargetDraggable();this._resetDragOptions(a),this._attachEventHandlers()}}},_getAction(e){return this["_".concat(e,"Action")]||this._createActionByOption(e)},_getAnonymousTemplateName:()=>Ie,_initTemplates(){this.option("contentTemplate")&&(this._templateManager.addDefaultTemplates({content:new re}),this.callBase.apply(this,arguments))},_render(){this.callBase(),this.$element().addClass(this._addWidgetPrefix());var e=this._templateManager.anonymousTemplateName===this.option("contentTemplate"),t=this._getTemplateByOption("contentTemplate");t&&g(t.render({container:this.element(),transclude:e}))},_optionChanged(e){var{name:t}=e;switch(t){case"onDragStart":case"onDragMove":case"onDragEnd":case"onDrop":case"onDragEnter":case"onDragLeave":case"onDragCancel":case"onDraggableElementShown":this["_".concat(t,"Action")]=this._createActionByOption(t);break;case"dragTemplate":case"contentTemplate":case"container":case"clone":break;case"allowMoveByClick":case"dragDirection":case"disabled":case"boundary":case"filter":case"immediate":this._resetDragElement(),this._detachEventHandlers(),this._attachEventHandlers();break;case"onCancelByEsc":this._keydownHandler();break;case"autoScroll":this._verticalScrollHelper.reset(),this._horizontalScrollHelper.reset();break;case"scrollSensitivity":case"scrollSpeed":case"boundOffset":case"handle":case"group":case"data":case"itemData":break;default:this.callBase(e)}},_getTargetDraggable(){return y||this},_getSourceDraggable(){return I||this},_setTargetDraggable(){var e=this.option("group"),t=this._getSourceDraggable();e&&e===t.option("group")&&(y=this)},_setSourceDraggable(){I=this},_resetSourceDraggable(){I=null},_resetTargetDraggable(){y=null},_resetDragOptions(e){this.reset(),e.reset(),this._stopAnimator(),this._horizontalScrollHelper.reset(),this._verticalScrollHelper.reset(),this._resetDragElement(),this._resetSourceElement(),this._resetTargetDraggable(),this._resetSourceDraggable()},_dispose(){this.callBase(),this._detachEventHandlers(),this._resetDragElement(),this._resetTargetDraggable(),this._resetSourceDraggable(),this._$sourceElement=null,this._stopAnimator()},_fireDragEnterEvent(e){var t=this._getEventArgs(e);this._getAction("onDragEnter")(t)},_fireDragLeaveEvent(e){var t=this._getEventArgs(e);this._getAction("onDragLeave")(t)}});U(E,K);var F=X(),Ce="dxSortable",G="placeholder",Pe="clone",Y=e=>g(e).is(":visible"),$e=(e,t)=>{var r,a;if(e){var i=((r=t.to)===null||r===void 0?void 0:r.left)||0,s=((a=t.to)===null||a===void 0?void 0:a.top)||0;e.style.transform="translate(".concat(i,"px,").concat(s,"px)"),e.style.transition="transform ".concat(t.duration,"ms ").concat(t.easing)}},ye=e=>{e&&(e.style.transform="",e.style.transition="")};function we(e){var t=e.offset(),{style:r}=e[0],a=parseFloat(r.paddingLeft)||0,i=parseFloat(r.paddingRight)||0,s=parseFloat(r.paddingTop)||0,l=e[0].clientWidth-(a+i),o=C(e),n=t.left+a,h=t.top+s;return{left:n,right:n+l,top:h,bottom:h+o}}var Me=K.inherit({_init(){this.callBase(),this._sourceScrollHandler=this._handleSourceScroll.bind(this),this._sourceScrollableInfo=null},_getDefaultOptions(){return m(this.callBase(),{clone:!0,filter:"> *",itemOrientation:"vertical",dropFeedbackMode:"push",allowDropInsideItem:!1,allowReordering:!0,moveItemOnDrop:!1,onDragChange:null,onAdd:null,onRemove:null,onReorder:null,onPlaceholderPrepared:null,animation:{type:"slide",duration:300,easing:"ease"},fromIndex:null,toIndex:null,dropInsideItem:!1,itemPoints:null,fromIndexOffset:0,offset:0,autoUpdate:!1,draggableElementSize:0})},reset(){this.option({dropInsideItem:!1,toIndex:null,fromIndex:null,itemPoints:null,fromIndexOffset:0,draggableElementSize:0}),this._$placeholderElement&&this._$placeholderElement.remove(),this._$placeholderElement=null,!this._isIndicateMode()&&this._$modifiedItem&&(this._$modifiedItem.css("marginBottom",this._modifiedItemMargin),this._$modifiedItem=null)},_getPrevVisibleItem:(e,t)=>e.slice(0,t).reverse().filter(Y)[0],_dragStartHandler(e){if(this.callBase.apply(this,arguments),e.cancel!==!0){var t=this._getSourceElement();this._updateItemPoints(),this._subscribeToSourceScroll(e),this.option("fromIndex",this._getElementIndex(t)),this.option("fromIndexOffset",this.option("offset"))}},_subscribeToSourceScroll(e){var t=this._getScrollable(g(e.target));t&&(this._sourceScrollableInfo={element:t,scrollLeft:t.scrollLeft(),scrollTop:t.scrollTop()},u.off(t,"scroll",this._sourceScrollHandler),u.on(t,"scroll",this._sourceScrollHandler))},_unsubscribeFromSourceScroll(){this._sourceScrollableInfo&&(u.off(this._sourceScrollableInfo.element,"scroll",this._sourceScrollHandler),this._sourceScrollableInfo=null)},_handleSourceScroll(e){var t=this._sourceScrollableInfo;t&&["scrollLeft","scrollTop"].forEach(r=>{if(e.target[r]!==t[r]){var a=e.target[r]-t[r];this._correctItemPoints(a),this._movePlaceholder(),t[r]=e.target[r]}})},_dragEnterHandler(e){if(this.callBase.apply(this,arguments),this!==this._getSourceDraggable()&&(this._subscribeToSourceScroll(e),this._updateItemPoints(),this.option("fromIndex",-1),!this._isIndicateMode())){var t=this.option("itemPoints"),r=t[t.length-1];if(r){var a=this.$element(),i=this._getSourceElement(),s=this._isVerticalOrientation(),l=s?S(i,!0):p(i,!0),o=a.get(0)[s?"scrollHeight":"scrollWidth"],n=a.get(0)[s?"scrollTop":"scrollLeft"],h=s?"top":"left",_=r[h],c=a.offset()[h],d=c+o-n-_;if(d<l&&s){var b=this._getItems(),v=g(this._getPrevVisibleItem(b));this._$modifiedItem=v,this._modifiedItemMargin=v.get(0).style.marginBottom,v.css("marginBottom",l-d);var f=v.closest(".dx-sortable"),B=f.data("dxScrollable")||f.data("dxScrollView");B&&B.update()}}}},_dragLeaveHandler(){this.callBase.apply(this,arguments),this!==this._getSourceDraggable()&&this._unsubscribeFromSourceScroll()},dragEnter(){this!==this._getTargetDraggable()&&this.option("toIndex",-1)},dragLeave(){this!==this._getTargetDraggable()&&this.option("toIndex",this.option("fromIndex"))},_allowDrop(e){var t=this._getTargetDraggable(),r=t.$element(),a=this._getScrollable(r);if(a){var{left:i,right:s,top:l,bottom:o}=we(a),n=this.option("toIndex"),h=this.option("itemPoints"),_=h==null?void 0:h.filter(d=>d.index===n)[0];if(_&&_.top!==void 0){var c=this._isVerticalOrientation();return c?l<=Math.ceil(_.top)&&Math.floor(_.top)<=o:i<=Math.ceil(_.left)&&Math.floor(_.left)<=s}}return!0},dragEnd(e){this._unsubscribeFromSourceScroll();var t=this._getSourceElement(),r=this._getSourceDraggable(),a=r.NAME!==this.NAME,i=this.option("toIndex"),{event:s}=e,l=this._allowDrop(s);if(i!==null&&i>=0&&l){var o,n;if(r!==this&&(o=this._fireAddEvent(s),o||(n=this._fireRemoveEvent(s))),a&&ge(t),this.option("moveItemOnDrop")&&!o&&this._moveItem(t,i,n),r===this)return this._fireReorderEvent(s)}return P().resolve()},dragMove(e){var t=this.option("itemPoints");if(t){for(var r=this._isVerticalOrientation(),a=r?"top":"left",i=r?e.pageY:e.pageX,s=this.option("rtlEnabled"),l,o=t.length-1;o>=0;o--){var n=t[o+1]&&(t[o][a]+t[o+1][a])/2;if((!r&&s?i>n:n>i)||n===void 0)l=t[o];else break}l&&(this._updatePlaceholderPosition(e,l),this._verticalScrollHelper.isScrolling()&&this._isIndicateMode()&&this._movePlaceholder())}},_isIndicateMode(){return this.option("dropFeedbackMode")==="indicate"||this.option("allowDropInsideItem")},_createPlaceholder(){var e;return this._isIndicateMode()&&(e=g("<div>").addClass(this._addWidgetPrefix(G)).insertBefore(this._getSourceDraggable()._$dragElement)),this._$placeholderElement=e,e},_getItems(){var e=this._getItemsSelector();return this._$content().find(e).not(".".concat(this._addWidgetPrefix(G))).not(".".concat(this._addWidgetPrefix(Pe))).toArray()},_allowReordering(){var e=this._getSourceDraggable(),t=this._getTargetDraggable();return e!==t||this.option("allowReordering")},_isValidPoint(e,t,r){var a=this.option("allowDropInsideItem"),i=r||this._allowReordering();return!i&&(e!==0||!a)?!1:this._isIndicateMode()?t===-1||e!==t&&(r||e!==t+1):!0},_getItemPoints(){var e=[],t,r,a,i=this.option("rtlEnabled"),s=this._isVerticalOrientation(),l=this._getItems(),o=l.filter(Y),n=o.length,h=this._getDraggableElement(),_=o.indexOf(h.get(0));if(n){for(var c=0;c<=n;c++){var d=!s&&i^c===n,b=s&&c===n;c<n&&(t=g(o[c]),r=t.offset(),a=p(t)),e.push({dropInsideItem:!1,left:r.left+(d?a:0),top:r.top+(b?e[c-1].height:0),index:c===n?l.length:l.indexOf(t.get(0)),$item:t,width:p(t),height:S(t),isValid:this._isValidPoint(c,_)})}if(this.option("allowDropInsideItem")){var v=e;e=[];for(var f=0;f<v.length;f++)e.push(v[f]),v[f+1]&&e.push(m({},v[f],{dropInsideItem:!0,top:Math.floor((v[f].top+v[f+1].top)/2),left:Math.floor((v[f].left+v[f+1].left)/2),isValid:this._isValidPoint(f,_,!0)}))}}else e.push({dropInsideItem:!1,index:0,isValid:!0});return e},_updateItemPoints(e){(e||this.option("autoUpdate")||!this.option("itemPoints"))&&this.option("itemPoints",this._getItemPoints())},_correctItemPoints(e){var t=this.option("itemPoints");if(e&&t&&!this.option("autoUpdate")){var r=this._isVerticalOrientation(),a=r?"top":"left";t.forEach(i=>{i[a]-=e})}},_getElementIndex(e){return this._getItems().indexOf(e.get(0))},_getDragTemplateArgs(e){var t=this.callBase.apply(this,arguments);return t.model.fromIndex=this._getElementIndex(e),t},_togglePlaceholder(e){this._$placeholderElement&&this._$placeholderElement.toggle(e)},_isVerticalOrientation(){return this.option("itemOrientation")==="vertical"},_normalizeToIndex(e,t){var r=this._getSourceDraggable()!==this._getTargetDraggable(),a=this._getActualFromIndex();return e===null?a:Math.max(r||a>=e||t?e:e-1,0)},_updatePlaceholderPosition(e,t){var r=this._getSourceDraggable(),a=this._normalizeToIndex(t.index,t.dropInsideItem),i=m(this._getEventArgs(e),{toIndex:a,dropInsideItem:t.dropInsideItem});if(t.isValid&&this._getAction("onDragChange")(i),i.cancel||!t.isValid){t.isValid||this.option({dropInsideItem:!1,toIndex:null});return}this.option({dropInsideItem:t.dropInsideItem,toIndex:t.index}),this._getAction("onPlaceholderPrepared")(m(this._getEventArgs(e),{placeholderElement:T(this._$placeholderElement),dragElement:T(r._$dragElement)})),this._updateItemPoints()},_makeWidthCorrection(e,t){if(this._$scrollable=this._getScrollable(e),this._$scrollable){var r=O(this._$scrollable),a=this._$scrollable.offset().left-e.offset().left,i=p(e)-a-r;a>0&&(t-=a),i>0&&(t-=i)}return t},_updatePlaceholderSizes(e,t){var r=this.option("dropInsideItem"),a=g(t),i=this._isVerticalOrientation(),s="",l="";e.toggleClass(this._addWidgetPrefix("placeholder-inside"),r),(i||r)&&(s=p(a)),(!i||r)&&(l=S(a)),s=this._makeWidthCorrection(a,s),e.css({width:s,height:l})},_moveItem(e,t,r){var a,i=this._getItems(),s=i[t],l=this._getSourceDraggable();r&&(e=e.clone(),l._toggleDragSourceClass(!1,e)),s||(a=i[t-1]),this._moveItemCore(e,s,a)},_moveItemCore(e,t,r){!t&&!r?e.appendTo(this.$element()):r?e.insertAfter(g(r)):e.insertBefore(g(t))},_getDragStartArgs(e,t){return m(this.callBase.apply(this,arguments),{fromIndex:this._getElementIndex(t)})},_getEventArgs(e){var t=this._getSourceDraggable(),r=this._getTargetDraggable(),a=r.option("dropInsideItem");return m(this.callBase.apply(this,arguments),{fromIndex:t.option("fromIndex"),toIndex:this._normalizeToIndex(r.option("toIndex"),a),dropInsideItem:a})},_optionChanged(e){var{name:t}=e;switch(t){case"onDragChange":case"onPlaceholderPrepared":case"onAdd":case"onRemove":case"onReorder":this["_".concat(t,"Action")]=this._createActionByOption(t);break;case"itemOrientation":case"allowDropInsideItem":case"moveItemOnDrop":case"dropFeedbackMode":case"itemPoints":case"animation":case"allowReordering":case"fromIndexOffset":case"offset":case"draggableElementSize":case"autoUpdate":break;case"fromIndex":[!1,!0].forEach(r=>{var a=r?e.value:e.previousValue;if(a!==null){var i=g(this._getItems()[a]);this._toggleDragSourceClass(r,i)}});break;case"dropInsideItem":this._optionChangedDropInsideItem(e);break;case"toIndex":this._optionChangedToIndex(e);break;default:this.callBase(e)}},_optionChangedDropInsideItem(){this._isIndicateMode()&&this._$placeholderElement&&this._movePlaceholder()},_isPositionVisible(e){var t=this.$element(),r;if(t.css("overflow")!=="hidden"?r=t.get(0):t.parents().each(function(){if(g(this).css("overflow")!=="visible")return r=this,!1}),r){var a=w(r),i=this._isVerticalOrientation(),s=i?"top":"left",l=i?"bottom":"right",o=i?F.pageYOffset:F.pageXOffset;if(e[s]<a[s]+o||e[s]>a[l]+o)return!1}return!0},_optionChangedToIndex(e){var t=e.value;if(this._isIndicateMode()){var r=t!==null&&t>=0;this._togglePlaceholder(r),r&&this._movePlaceholder()}else this._moveItems(e.previousValue,e.value,e.fullUpdate)},update(){if(!(this.option("fromIndex")===null&&this.option("toIndex")===null)){this._updateItemPoints(!0),this._updateDragSourceClass();var e=this.option("toIndex");this._optionChangedToIndex({value:e,fullUpdate:!0})}},_updateDragSourceClass(){var e=this._getActualFromIndex(),t=g(this._getItems()[e]);t.length&&(this._$sourceElement=t,this._toggleDragSourceClass(!0,t))},_makeLeftCorrection(e){var t=this._$scrollable;if(t&&this._isVerticalOrientation()){var r=t.offset().left-e;r>0&&(e+=r)}return e},_movePlaceholder(){var e=this._$placeholderElement||this._createPlaceholder();if(e){var t=this._getItems(),r=this.option("toIndex"),a=this._isVerticalOrientation(),i=this.option("rtlEnabled"),s=this.option("dropInsideItem"),l=null,o=t[r];if(o){var n=g(o);l=n.offset(),!a&&i&&!s&&(l.left+=p(n,!0))}else{var h=o=this._getPrevVisibleItem(t,r);h&&(l=g(h).offset(),a?l.top+=S(h,!0):i||(l.left+=p(h,!0)))}if(this._updatePlaceholderSizes(e,o),l&&!this._isPositionVisible(l)&&(l=null),l){var _=a&&r===t.length,c=S(e);l.left=this._makeLeftCorrection(l.left),l.top=_&&l.top>=c?l.top-c:l.top,this._move(l,e)}e.toggle(!!l)}},_getPositions(e,t,r,a){for(var i=[],s=0;s<e.length;s++){var l=0;if(a===null||r===null){i.push(l);continue}r===-1?s>=a&&(l=t):a===-1?s>r&&(l=-t):r<a?s>r&&s<a&&(l=-t):r>a&&s>=a&&s<r&&(l=t),i.push(l)}return i},_getDraggableElementSize(e){var t=this._getDraggableElement(),r=this.option("draggableElementSize");return r||(r=e?(S(t)+S(t,!0))/2:(p(t)+p(t,!0))/2,this.option("autoUpdate")||this.option("draggableElementSize",r)),r},_getActualFromIndex(){var{fromIndex:e,fromIndexOffset:t,offset:r}=this.option();return e==null?null:e+t-r},_moveItems(e,t,r){for(var a=this._getActualFromIndex(),i=this._isVerticalOrientation(),s=i?"top":"left",l=this._getDraggableElementSize(i),o=this._getItems(),n=this._getPositions(o,l,a,e),h=this._getPositions(o,l,a,t),_=this.option("animation"),c=this.option("rtlEnabled"),d=0;d<o.length;d++){var b=o[d],v=n[d],f=h[d];t===null||a===null?ye(b):(v!==f||r&&f)&&$e(b,m({},_,{to:{[s]:!i&&c?-f:f}}))}},_toggleDragSourceClass(e,t){var r=t||this._$sourceElement;this.callBase.apply(this,arguments),this._isIndicateMode()||r&&r.toggleClass(this._addWidgetPrefix("source-hidden"),e)},_dispose(){this.reset(),this.callBase()},_fireAddEvent(e){var t=this._getEventArgs(e);return this._getAction("onAdd")(t),t.cancel},_fireRemoveEvent(e){var t=this._getSourceDraggable(),r=this._getEventArgs(e);return t._getAction("onRemove")(r),r.cancel},_fireReorderEvent(e){var t=this._getEventArgs(e);return this._getAction("onReorder")(t),t.promise||P().resolve()}});U(Ce,Me);export{K as D,Me as S};
