import{a as I,e as _,d as D,z as rt,a_ as ot,a$ as lt,C as W,T as $e,u as ee,$ as o,r as ve,t as te,a1 as m,_ as Ue,P as H,Y as Xe,k as dt,g as We,ai as ht,R as ne,o as _e,p as Ge,aL as be,L as ut,m as Ee,U as ct,X as Ie,V as _t,l as mt}from"./index.ab648286.js";import{a7 as fe,Z as h,a0 as g,bE as Z,T as u,U as C,$ as k,a9 as w,ak as pt,aB as vt,aE as ft,ae as ye,a8 as ge,bF as ze,bu as gt,aD as St,W as v,ay as Ct,ai as bt,af as Ae,ab as Et,a1 as Ne,Y as It}from"./entry.d8c3daa0.js";import{g as me,a as yt,B as At}from"./resize_observer.57c96ed3.js";import{s as ie,C as xe}from"./check_box.j.46b9e12f.js";import{T as qe}from"./text_box.67135b71.js";import{q as se,s as Nt,c as xt,B as Tt,P as Ot,u as Dt,j as kt,k as wt,i as Mt,v as Bt,w as Lt,x as Ft,y as Ht}from"./ui.collection_widget.edit.f359a828.js";var Se="dxdblclick",Kt="dxDblClick",Te=I(W,Kt),Oe=300,Rt=fe.inherit({ctor:function(){this._handlerCount=0,this._forgetLastClick()},_forgetLastClick:function(){this._firstClickTarget=null,this._lastClickTimeStamp=-Oe},add:function(){this._handlerCount<=0&&_.on(D.getDocument(),Te,this._clickHandler.bind(this)),this._handlerCount++},_clickHandler:function(i){var e=i.timeStamp||Date.now(),t=e-this._lastClickTimeStamp,n=t<0,s=!n&&t<Oe;s?(rt({type:Se,target:ot(this._firstClickTarget,i.target),originalEvent:i}),this._forgetLastClick()):(this._firstClickTarget=i.target,this._lastClickTimeStamp=e)},remove:function(){this._handlerCount--,this._handlerCount<=0&&(this._forgetLastClick(),_.off(D.getDocument(),Te))}});lt(Se,new Rt);var Vt=fe.inherit({ctor:function(){this._dataStructure=[],this._itemsCount=0,this._visibleItemsCount=0},_indexByKey:{},_convertItemsToNodes:function(i,e){var t=this;h(i,function(n,s){var a=g(e)?e:t._getParentId(s),r=t._convertItemToNode(s,a);t._dataStructure.push(r),t._checkForDuplicateId(r.internalFields.key),t._indexByKey[r.internalFields.key]=t._dataStructure.length-1,t._itemHasChildren(s)&&t._convertItemsToNodes(t._dataAccessors.getters.items(s),r.internalFields.key)})},_checkForDuplicateId:function(i){if(g(this._indexByKey[i]))throw $e.Error("E1040",i)},_getParentId:function(i){return this._dataType==="plain"?this._dataAccessors.getters.parentKey(i):void 0},_itemHasChildren:function(i){if(this._dataType!=="plain"){var e=this._dataAccessors.getters.items(i);return e&&e.length}},_getUniqueKey:function(i){var e=this._dataAccessors.getters.key,t=e(i),n=e&&(t||t===0)&&Z(t);return n?t:this.getItemsCount()},_convertItemToNode:function(i,e){this._itemsCount++,i.visible!==!1&&this._visibleItemsCount++;var t={internalFields:{disabled:this._dataAccessors.getters.disabled(i,{defaultValue:!1}),expanded:this._dataAccessors.getters.expanded(i,{defaultValue:!1}),selected:this._dataAccessors.getters.selected(i,{defaultValue:!1}),key:this._getUniqueKey(i),parentKey:g(e)?e:this._rootValue,item:this._makeObjectFromPrimitive(i),childrenKeys:[]}};return u(t,i),delete t.items,t},setChildrenKeys:function(){var i=this;h(this._dataStructure,function(e,t){if(t.internalFields.parentKey!==i._rootValue){var n=i.getParentNode(t);n&&n.internalFields.childrenKeys.push(t.internalFields.key)}})},_makeObjectFromPrimitive:function(i){if(Z(i)){var e=i;i={},this._dataAccessors.setters.key(i,e)}return i},_convertToPublicNode:function(i,e){if(!i)return null;var t={text:this._dataAccessors.getters.display(i),key:i.internalFields.key,selected:i.internalFields.selected,expanded:i.internalFields.expanded,disabled:i.internalFields.disabled,parent:e||null,itemData:i.internalFields.item,children:[],items:[]};return t.parent&&(t.parent.children.push(t),t.parent.items.push(t)),t},convertToPublicNodes:function(i,e){if(!i.length)return[];var t=this,n=[];return h(i,function(s,a){a=Z(a)?t._getByKey(a):a;var r=t._convertToPublicNode(a,e);r.children=t.convertToPublicNodes(a.internalFields.childrenKeys,r),n.push(r),a.internalFields.publicNode=r}),n},setDataAccessors:function(i){this._dataAccessors=i},_getByKey:function(i){return this._dataStructure[this.getIndexByKey(i)]||null},getParentNode:function(i){return this._getByKey(i.internalFields.parentKey)},getByKey:function(i,e){if(e==null)return null;var t=null,n=this,s=function(a,r){return h(a,function(l,d){var c=d.internalFields&&d.internalFields.key||n._dataAccessors.getters.key(d);if(c.toString()===r.toString())return t=d,!1}),t};return s(i,e)},getItemsCount:function(){return this._itemsCount},getVisibleItemsCount:function(){return this._visibleItemsCount},updateIndexByKey:function(){var i=this;this._indexByKey={},h(this._dataStructure,function(e,t){i._checkForDuplicateId(t.internalFields.key),i._indexByKey[t.internalFields.key]=e})},updateChildrenKeys:function(){this._indexByKey={},this.removeChildrenKeys(),this.updateIndexByKey(),this.setChildrenKeys()},removeChildrenKeys:function(){this._indexByKey={},h(this._dataStructure,function(i,e){e.internalFields.childrenKeys=[]})},getIndexByKey:function(i){return this._indexByKey[i]},createPlainStructure:function(i,e,t){return this._itemsCount=0,this._visibleItemsCount=0,this._rootValue=e,this._dataType=t,this._indexByKey={},this._convertItemsToNodes(i),this.setChildrenKeys(),this._dataStructure}}),B="expanded",O="selected",Pt="disabled";ie.setEditorClass(qe);var $t=fe.inherit({ctor:function(i){this.options={},u(this.options,this._defaultOptions(),i),this.options.dataConverter.setDataAccessors(this.options.dataAccessors),this._selectedNodesKeys=[],this._expandedNodesKeys=[],this._dataStructure=[],this._createInternalDataStructure(),this.getTreeNodes()},setOption:function(i,e){this.options[i]=e,i==="recursiveSelection"&&this._updateSelection()},_defaultOptions:function(){return{dataAccessors:void 0,items:[],multipleSelection:!0,recursiveSelection:!1,recursiveExpansion:!1,rootValue:0,searchValue:"",dataType:"tree",searchMode:"contains",dataConverter:new Vt,onNodeChanged:C,sort:null}},_createInternalDataStructure:function(){this._initialDataStructure=this.options.dataConverter.createPlainStructure(this.options.items,this.options.rootValue,this.options.dataType),this._dataStructure=this.options.searchValue.length?this.search(this.options.searchValue):this._initialDataStructure,this.options.dataConverter._dataStructure=this._dataStructure,this._updateSelection(),this._updateExpansion()},_updateSelection:function(){this.options.recursiveSelection&&(this._setChildrenSelection(),this._setParentSelection()),this._selectedNodesKeys=this._updateNodesKeysArray(O)},_updateExpansion:function(i){this.options.recursiveExpansion&&(i?this._updateOneBranch(i):this._setParentExpansion()),this._expandedNodesKeys=this._updateNodesKeysArray(B)},_updateNodesKeysArray:function(i){var e=this,t=[];return h(e._getDataBySelectionMode(),function(n,s){e._isNodeVisible(s)&&s.internalFields[i]&&(i===B||e.options.multipleSelection?t.push(s.internalFields.key):(t.length&&e.toggleSelection(t[0],!1,!0),t=[s.internalFields.key]))}),t},_getDataBySelectionMode:function(){return this.options.multipleSelection?this.getData():this.getFullData()},_isNodeVisible:function(i){return i.internalFields.item.visible!==!1},_getByKey:function(i,e){return i===this._dataStructure?this.options.dataConverter._getByKey(e):this.options.dataConverter.getByKey(i,e)},_setChildrenSelection:function(){var i=this;h(this._dataStructure,function(e,t){if(t.internalFields.childrenKeys.length){var n=t.internalFields.selected;n===!0&&i._toggleChildrenSelection(t,n)}})},_setParentSelection:function(){var i=this;h(this._dataStructure,function(e,t){var n=i.options.dataConverter.getParentNode(t);n&&t.internalFields.parentKey!==i.options.rootValue&&i._iterateParents(t,function(s){var a=i._calculateSelectedState(s);i._setFieldState(s,O,a)})})},_setParentExpansion:function(){var i=this;h(this._dataStructure,function(e,t){t.internalFields.expanded&&i._updateOneBranch(t.internalFields.key)})},_updateOneBranch:function(i){var e=this,t=this.getNodeByKey(i);e._iterateParents(t,function(n){e._setFieldState(n,B,!0)})},_iterateChildren:function(i,e,t,n){if(k(t)){var s=this,a=i.internalFields.key;n=n||[],n.indexOf(a)===-1&&(n.push(a),h(i.internalFields.childrenKeys,function(r,l){var d=s.getNodeByKey(l);t(d),d.internalFields.childrenKeys.length&&e&&s._iterateChildren(d,e,t,n)}))}},_iterateParents:function(i,e,t){if(!(i.internalFields.parentKey===this.options.rootValue||!k(e))){t=t||[];var n=i.internalFields.key;if(t.indexOf(n)===-1){t.push(n);var s=this.options.dataConverter.getParentNode(i);s&&(e(s),s.internalFields.parentKey!==this.options.rootValue&&this._iterateParents(s,e,t))}}},_calculateSelectedState:function(i){for(var e=i.internalFields.childrenKeys.length,t=0,n=0,s=!1,a=0;a<=e-1;a++){var r=this.getNodeByKey(i.internalFields.childrenKeys[a]),l=r.internalFields.item.visible===!1,d=r.internalFields.selected;if(l){n++;continue}d?t++:d===void 0&&(t+=.5)}return t&&(s=t===e-n?!0:void 0),s},_toggleChildrenSelection:function(i,e){var t=this;this._iterateChildren(i,!0,function(n){t._isNodeVisible(n)&&t._setFieldState(n,O,e)})},_setFieldState:function(i,e,t){i.internalFields[e]!==t&&(i.internalFields[e]=t,i.internalFields.publicNode&&(i.internalFields.publicNode[e]=t),this.options.dataAccessors.setters[e](i.internalFields.item,t),this.options.onNodeChanged(i))},_markChildren:function(i){var e=this;h(i,function(t,n){var s=e.getIndexByKey(n),a=e.getNodeByKey(n);e._dataStructure[s]=0,a.internalFields.childrenKeys.length&&e._markChildren(a.internalFields.childrenKeys)})},_removeNode:function(i){var e=this.getNodeByKey(i);this._dataStructure[this.getIndexByKey(i)]=0,this._markChildren(e.internalFields.childrenKeys);var t=this,n=0,s=u([],this._dataStructure);h(s,function(a,r){r||(t._dataStructure.splice(a-n,1),n++)})},_addNode:function(i){var e=this.options.dataConverter,t=e._convertItemToNode(i,this.options.dataAccessors.getters.parentKey(i));this._dataStructure=this._dataStructure.concat(t),this._initialDataStructure=this._initialDataStructure.concat(t),e._dataStructure=e._dataStructure.concat(t)},_updateFields:function(){this.options.dataConverter.updateChildrenKeys(),this._updateSelection(),this._updateExpansion()},getSelectedNodesKeys:function(){return this._selectedNodesKeys},getExpandedNodesKeys:function(){return this._expandedNodesKeys},getData:function(){return this._dataStructure},getFullData:function(){return this._initialDataStructure},getNodeByItem:function(i){var e=null;return h(this._dataStructure,function(t,n){if(n.internalFields.item===i)return e=n,!1}),e},getNodesByItems:function(i){var e=this,t=[];return h(i,function(n,s){var a=e.getNodeByItem(s);a&&t.push(a)}),t},getNodeByKey:function(i,e){return this._getByKey(e||this._getDataBySelectionMode(),i)},getTreeNodes:function(){return this.options.dataConverter.convertToPublicNodes(this.getRootNodes())},getItemsCount:function(){return this.options.dataConverter.getItemsCount()},getVisibleItemsCount:function(){return this.options.dataConverter.getVisibleItemsCount()},getPublicNode:function(i){return i.internalFields.publicNode},getRootNodes:function(){return this.getChildrenNodes(this.options.rootValue)},getChildrenNodes:function(i){return se(this._dataStructure,{langParams:this.options.langParams}).filter(["internalFields.parentKey",i]).toArray()},getIndexByKey:function(i){return this.options.dataConverter.getIndexByKey(i)},addItem:function(i){this._addNode(i),this._updateFields()},removeItem:function(i){this._removeNode(i),this._updateFields()},toggleSelection:function(i,e,t){var n=this._isSingleModeUnselect(e),s=this._getByKey(t||n?this._initialDataStructure:this._dataStructure,i);this._setFieldState(s,O,e),this.options.recursiveSelection&&!t&&(e?this._setChildrenSelection():this._toggleChildrenSelection(s,e),this._setParentSelection()),this._selectedNodesKeys=this._updateNodesKeysArray(O)},_isSingleModeUnselect:function(i){return!this.options.multipleSelection&&!i},toggleNodeDisabledState:function(i,e){var t=this.getNodeByKey(i);this._setFieldState(t,Pt,e)},toggleSelectAll:function(i){if(g(i)){var e=this,t=e._selectedNodesKeys[e._selectedNodesKeys.length-1],n=e._isSingleModeUnselect(i)?this._initialDataStructure:this._dataStructure;h(n,function(s,a){e._isNodeVisible(a)&&e._setFieldState(a,O,i)}),e._selectedNodesKeys=e._updateNodesKeysArray(O),!i&&e.options.selectionRequired&&e.toggleSelection(t,!0)}},isAllSelected:function(){return this.getSelectedNodesKeys().length?this.getSelectedNodesKeys().length===this.getVisibleItemsCount()?!0:void 0:!1},toggleExpansion:function(i,e){var t=this.getNodeByKey(i);this._setFieldState(t,B,e),e&&this._updateExpansion(i),this._expandedNodesKeys=this._updateNodesKeysArray(B)},isFiltered:function(i){return!this.options.searchValue.length||!!this._filterDataStructure(this.options.searchValue,[i]).length},_createCriteria:function(i,e,t){var n=[];return Array.isArray(i)?(h(i,function(s,a){n.push([a,t,e],"or")}),n.pop(),n):[i,t,e]},_filterDataStructure:function(i,e){var t=this.options.searchExpr||this.options.dataAccessors.getters.display,n=ie.getOperationBySearchMode(this.options.searchMode),s=this._createCriteria(t,i,n);return e=e||this._initialDataStructure,se(e,{langParams:this.options.langParams}).filter(s).toArray()},search:function(i){var e=this,t=this._filterDataStructure(i),n=this.options.dataConverter;return function s(a,r){for(var l=a.length;r<l;){var d=a[r];if(d.internalFields.parentKey===e.options.rootValue){r++;continue}var c=n.getParentNode(d);if(!c){$e.log("W1007",d.internalFields.parentKey,d.internalFields.key),r++;continue}if(c.internalFields.expanded||e._setFieldState(c,B,!0),a.includes(c)){r++;continue}a.splice(r,0,c),s(a,r)}}(t,0),this.options.sort&&(t=Nt.queryByOptions(se(t),{sort:this.options.sort,langParams:this.options.langParams}).toArray()),n._indexByKey={},h(t,function(s,a){a.internalFields.childrenKeys=[],n._indexByKey[a.internalFields.key]=s}),n._dataStructure=t,n.setChildrenKeys(),n._dataStructure}}),Ut="dx-state-disabled",Xt="dx-item-url",je=xt.inherit({_getDefaultOptions:function(){return u(this.callBase(),{keyExpr:"id",displayExpr:"text",selectedExpr:"selected",disabledExpr:"disabled",itemsExpr:"items",hoverStateEnabled:!0,parentIdExpr:"parentId",expandedExpr:"expanded"})},_defaultOptionsRules:function(){return this.callBase().concat([{device:function(){return ee.real().deviceType==="desktop"&&!ee.isSimulator()},options:{focusStateEnabled:!0}}])},_init:function(){this.callBase(),this._initAccessors(),this._initDataAdapter(),this._initDynamicTemplates()},_initDataSource:function(){this.callBase(),this._dataSource&&this._dataSource.paginate(!1)},_initDataAdapter:function(){var i=this._createDataAdapterAccessors();this._dataAdapter=new $t(u({dataAccessors:{getters:i.getters,setters:i.setters},items:this.option("items")},this._getDataAdapterOptions()))},_getDataAdapterOptions:C,_getItemExtraPropNames:C,_initDynamicTemplates:function(){var i=["text","html","items","icon"].concat(this._getItemExtraPropNames());this._templateManager.addDefaultTemplates({item:new Tt(this._addContent.bind(this),i,this.option("integrationOptions.watchMethod"),{text:this._displayGetter,items:this._itemsGetter})})},_addContent:function(i,e){i.html(e.html).append(this._getIconContainer(e)).append(this._getTextContainer(e))},_getLinkContainer:function(i,e,t){var{linkAttr:n,url:s}=t,a=w(n)?n:{};return o("<a>").addClass(Xt).attr(pt({},a,{href:s})).append(i).append(e)},_getIconContainer:function(i){return i.icon?me(i.icon):void 0},_getTextContainer:function(i){return o("<span>").text(i.text)},_initAccessors:function(){var i=this;h(this._getAccessors(),function(e,t){i._compileAccessor(t)}),this._compileDisplayGetter()},_getAccessors:function(){return["key","selected","items","disabled","parentId","expanded"]},_getChildNodes:function(i){var e=this,t=[];return h(i.internalFields.childrenKeys,function(n,s){var a=e._dataAdapter.getNodeByKey(s);t.push(a)}),t},_hasChildren:function(i){return i&&i.internalFields.childrenKeys.length},_compileAccessor:function(i){var e="_"+i+"Getter",t="_"+i+"Setter",n=this.option(i+"Expr");if(n){if(k(n)){this[t]=function(s,a){s[n()]=a},this[e]=function(s){return s[n()]};return}}else{this[e]=C,this[t]=C;return}this[e]=vt(n),this[t]=ft(n)},_createDataAdapterAccessors:function(){var i=this,e={getters:{},setters:{}};return h(this._getAccessors(),function(t,n){var s="_"+n+"Getter",a="_"+n+"Setter",r=n==="parentId"?"parentKey":n;e.getters[r]=i[s],e.setters[r]=i[a]}),e.getters.display=this._displayGetter?this._displayGetter:t=>t.text,e},_initMarkup:function(){this.callBase(),this._addWidgetClass()},_addWidgetClass:function(){this._focusTarget().addClass(this._widgetClass())},_widgetClass:C,_renderItemFrame:function(i,e){var t=this.callBase.apply(this,arguments);return t.toggleClass(Ut,!!this._disabledGetter(e)),t},_optionChanged:function(i){switch(i.name){case"displayExpr":case"keyExpr":this._initAccessors(),this._initDynamicTemplates(),this.repaint();break;case"itemsExpr":case"selectedExpr":case"disabledExpr":case"expandedExpr":case"parentIdExpr":this._initAccessors(),this._initDataAdapter(),this.repaint();break;case"items":this._initDataAdapter(),this.callBase(i);break;default:this.callBase(i)}}});class Wt extends Ot{_getPlainItems(){return ye(this._collectionWidget.option("items"),function e(t){return t.items?[t].concat(ye(t.items,e)):t})}_stringifyItem(e){return JSON.stringify(e,(t,n)=>t==="template"?this._getTemplateString(n):n)}_getTemplateString(e){var t;return typeof e=="object"?t=o(e).text():t=e.toString(),t}}var z="dx-menu",Gt=z+"-no-icons",zt="dx-menu-base",E=z+"-item",qt=E+"-content",ae=E+"-selected",De=E+"-wrapper",jt=z+"-items-container",Yt=E+"-expanded",Zt=z+"-separator",Jt=z+"-last-group-item",Qt=E+"-has-text",ei=E+"-has-icon",ti=E+"-has-submenu",Ye=E+"-popout",ii=Ye+"-container",Ze=E+"-text",ni="single",si={show:50,hide:300},ai="".concat(Ze,"-with-url"),ri="dx-icon-with-url",oi="dx-item-url";class Ce extends je{_getDefaultOptions(){return u(super._getDefaultOptions(),{items:[],cssClass:"",activeStateEnabled:!0,showSubmenuMode:{name:"onHover",delay:{show:50,hide:300}},animation:{show:{type:"fade",from:0,to:1,duration:100},hide:{type:"fade",from:1,to:0,duration:100}},selectByClick:!1,focusOnSelectedItem:!1,keyExpr:null,_itemAttributes:{role:"menuitem"},useInkRipple:!1})}_itemDataKey(){return"dxMenuItemDataKey"}_itemClass(){return E}_setAriaSelectionAttribute(){}_selectedItemClass(){return ae}_widgetClass(){return zt}_focusTarget(){return this._itemContainer()}_clean(){this.option("focusedElement",null),super._clean()}_supportedKeys(){return u(super._supportedKeys(),{space:()=>{var e=o(this.option("focusedElement"));!e.length||!this._isSelectionEnabled()||this.selectItem(e[0])},pageUp:C,pageDown:C})}_isSelectionEnabled(){return this.option("selectionMode")===ni}_init(){this._activeStateUnit=".".concat(E),super._init(),this._renderSelectedItem(),this._initActions()}_getLinkContainer(e,t,n){var{linkAttr:s,url:a}=n;return e==null||e.addClass(ri),t==null||t.addClass(ai),super._getLinkContainer(e,t,{linkAttr:s,url:a})}_addContent(e,t){var{html:n,url:s}=t;if(s){e.html(n);var a=this._getLinkContainer(this._getIconContainer(t),this._getTextContainer(t),t);e.append(a)}else super._addContent(e,t);e.append(this._getPopoutContainer(t)),this._addContentClasses(t,e.parent())}_getTextContainer(e){var{text:t}=e;if(t){var n=o("<span>").addClass(Ze),s=ge(e)?t:String(e);return n.text(s)}}_getItemExtraPropNames(){return["url","linkAttr"]}_getPopoutContainer(e){var t=e.items,n;if(t&&t.length){var s=o("<div>").addClass(Ye);n=o("<span>").addClass(ii).append(s)}return n}_getDataAdapterOptions(){return{rootValue:0,multipleSelection:!1,recursiveSelection:!1,recursiveExpansion:!1,searchValue:""}}_selectByItem(e){if(e){var t=this._dataAdapter.getNodeByItem(e);this._dataAdapter.toggleSelection(t.internalFields.key,!0)}}_renderSelectedItem(){var e=this._dataAdapter.getSelectedNodesKeys(),t=e.length&&e[0],n=this.option("selectedItem");if(!t){this._selectByItem(n);return}var s=this._dataAdapter.getNodeByKey(t);if(s.selectable!==!1){if(!n){this.option("selectedItem",s.internalFields.item);return}n!==s.internalFields.item&&(this._dataAdapter.toggleSelection(t,!1),this._selectByItem(n))}}_initActions(){}_initMarkup(){super._initMarkup(),this.option("useInkRipple")&&this._renderInkRipple()}_renderInkRipple(){this._inkRipple=yt()}_toggleActiveState(e,t,n){if(super._toggleActiveState.apply(this,arguments),!!this._inkRipple){var s={element:e,event:n};t?this._inkRipple.showWave(s):this._inkRipple.hideWave(s)}}_getShowSubmenuMode(){var e=this.option("showSubmenuMode");return e=w(e)?e.name:e,this._isDesktopDevice()?e:"onClick"}_initSelectedItems(){}_isDesktopDevice(){return ee.real().deviceType==="desktop"}_initEditStrategy(){var e=Wt;this._editStrategy=new e(this)}_addCustomCssClass(e){e.addClass(this.option("cssClass"))}_itemWrapperSelector(){return".".concat(De)}_hoverStartHandler(e){var t=this._getItemElementByEventArgs(e);!t||this._isItemDisabled(t)||(e.stopPropagation(),this._getShowSubmenuMode()==="onHover"&&(clearTimeout(this._showSubmenusTimeout),this._showSubmenusTimeout=setTimeout(this._showSubmenu.bind(this,t),this._getSubmenuDelay("show"))))}_getAvailableItems(e){return super._getAvailableItems(e).filter(function(){return o(this).css("visibility")!=="hidden"})}_isItemDisabled(e){return this._disabledGetter(e.data(this._itemDataKey()))}_showSubmenu(e){this._addExpandedClass(e)}_addExpandedClass(e){o(e).addClass(Yt)}_getSubmenuDelay(e){var{delay:t}=this.option("showSubmenuMode");return g(t)?w(t)?t[e]:t:si[e]}_getItemElementByEventArgs(e){var t=o(e.target);if(t.hasClass(this._itemClass())||t.get(0)===e.currentTarget)return t;for(;!t.hasClass(this._itemClass());)if(t=t.parent(),t.hasClass("dx-submenu"))return null;return t}_hoverEndHandler(){clearTimeout(this._showSubmenusTimeout)}_hasSubmenu(e){return e&&e.internalFields.childrenKeys.length}_renderContentImpl(){this._renderItems(this._dataAdapter.getRootNodes())}_renderItems(e,t){if(e.length){this.hasIcons=!1;var n=this._renderContainer(this.$element(),t),s=-1,a=-1;h(e,(r,l)=>{var d=l.visible!==!1;d&&s<0&&(s=r);var c=s<r&&(l.beginGroup||r===a);c&&(a=d?r:r+1),r===a&&s<r&&this._renderSeparator(n),this._renderItem(r,l,n)}),this.hasIcons||n.addClass(Gt)}}_renderContainer(e){var t=o("<ul>");return this.setAria("role","none",t),t.appendTo(e).addClass(jt)}_createDOMElement(e){var t=o("<li>");return this.setAria("role","none",t),t.appendTo(e).addClass(De)}_renderItem(e,t,n,s){var a=this.option("items"),r=s||this._createDOMElement(n);a[e+1]&&a[e+1].beginGroup&&r.addClass(Jt);var l=super._renderItem(e,t.internalFields.item,r);t.internalFields.item===this.option("selectedItem")&&l.addClass(ae),l.attr("tabIndex",-1),this._hasSubmenu(t)&&this.setAria("haspopup","true",l)}_renderItemFrame(e,t,n){var s=n.children(".".concat(E));return s.length?s:super._renderItemFrame.apply(this,arguments)}_refreshItem(e,t){var n=this._dataAdapter.getNodeByItem(t),s=e.data(this._itemIndexKey()),a=e.closest("ul"),r=e.closest("li");this._renderItem(s,n,a,r)}_addContentClasses(e,t){var n=e.text?!!e.text.length:!1,s=!!e.icon,a=e.items?!!e.items.length:!1;t.toggleClass(Qt,n),t.toggleClass(ei,s),this.hasIcons||(this.hasIcons=s),t.toggleClass(ti,a)}_getItemContent(e){var t=super._getItemContent(e);return t.length||(t=e.children(".".concat(qt))),t}_postprocessRenderItem(e){var t=o(e.itemElement),n=this._dataAdapter.getSelectedNodesKeys();if(!n.length||!this._selectedGetter(e.itemData)||!this._isItemSelectable(e.itemData)){this._setAriaSelectionAttribute(t,"false");return}var s=this._dataAdapter.getNodeByItem(e.itemData);s.internalFields.key===n[0]?(t.addClass(this._selectedItemClass()),this._setAriaSelectionAttribute(t,"true")):this._setAriaSelectionAttribute(t,"false")}_isItemSelectable(e){return e.selectable!==!1}_renderSeparator(e){o("<li>").appendTo(e).addClass(Zt)}_itemClickHandler(e){if(!e._skipHandling){var t=this._createAction(this._updateSubmenuVisibilityOnClick.bind(this));this._itemDXEventHandler(e,"onItemClick",{},{beforeExecute:this._itemClick,afterExecute:t.bind(this)}),e._skipHandling=!0}}_itemClick(e){var t=e.args[0],n=t.event.target.getElementsByClassName(oi)[0];t.itemData.url&&n&&n.click()}_updateSubmenuVisibilityOnClick(e){this._updateSelectedItemOnClick(e),this._getShowSubmenuMode()==="onClick"&&this._addExpandedClass(e.args[0].itemElement)}_updateSelectedItemOnClick(e){var t=e.args?e.args[0]:e;if(this._isItemSelectAllowed(t.itemData)){var n=this._dataAdapter.getSelectedNodesKeys(),s=n.length&&this._dataAdapter.getNodeByKey(n[0]);s&&this._toggleItemSelection(s,!1),!s||s.internalFields.item!==t.itemData?this.selectItem(t.itemData):(this._fireSelectionChangeEvent(null,this.option("selectedItem")),this._setOptionWithoutOptionChange("selectedItem",null))}}_isItemSelectAllowed(e){var t=this._isSelectionEnabled()&&this.option("selectByClick");return!this._isContainerEmpty()&&t&&this._isItemSelectable(e)&&!this._itemsGetter(e)}_isContainerEmpty(){return this._itemContainer().is(":empty")}_syncSelectionOptions(){return ze()}_optionChanged(e){switch(e.name){case"showSubmenuMode":break;case"selectedItem":var t=this._dataAdapter.getNodeByItem(e.value),n=this._dataAdapter.getSelectedNodesKeys()[0];if(t&&t.internalFields.key!==n){if(t.selectable===!1)break;n&&this._toggleItemSelection(this._dataAdapter.getNodeByKey(n),!1),this._toggleItemSelection(t,!0),this._updateSelectedItems()}break;case"cssClass":case"position":case"selectByClick":case"animation":case"useInkRipple":this._invalidate();break;default:super._optionChanged(e)}}_toggleItemSelection(e,t){var n=this._getElementByItem(e.internalFields.item);n&&o(n).toggleClass(ae),this._dataAdapter.toggleSelection(e.internalFields.key,t)}_getElementByItem(e){var t;return h(this._itemElements(),(n,s)=>o(s).data(this._itemDataKey())!==e?!0:(t=s,!1)),t}_updateSelectedItems(e,t){(e||t)&&this._fireSelectionChangeEvent(t,e)}_fireSelectionChangeEvent(e,t){this._createActionByOption("onSelectionChanged",{excludeValidators:["disabled","readOnly"]})({addedItems:[e],removedItems:[t]})}selectItem(e){var t=e.nodeType?this._getItemData(e):e,n=this._dataAdapter.getSelectedNodesKeys()[0],s=this.option("selectedItem"),a=this._dataAdapter.getNodeByItem(t);a.internalFields.key!==n&&(n&&this._toggleItemSelection(this._dataAdapter.getNodeByKey(n),!1),this._toggleItemSelection(a,!0),this._updateSelectedItems(s,t),this._setOptionWithoutOptionChange("selectedItem",t))}unselectItem(e){var t=e.nodeType?this._getItemData(e):e,n=this._dataAdapter.getNodeByItem(t),s=this.option("selectedItem");n.internalFields.selected&&(this._toggleItemSelection(n,!1),this._updateSelectedItems(s,null),this._setOptionWithoutOptionChange("selectedItem",null))}}Ce.ItemClass=Dt;var Je="dx-menu",G=Je+"-item",L=G+"-expanded",li="dx-menu-phone-overlay",q=Je+"-items-container",ke=G+"-wrapper",S="dx-submenu",di="dx-context-menu",hi="dx-has-context-menu",ui="dx-state-disabled",ci="dx-state-focused",we="dx-state-hover",_i="dx-overlay-content",Qe="up",et="down",mi="left",pi="right",tt="first",it="last",Me=["onShowing","onShown","onSubmenuCreated","onHiding","onHidden","onPositioning","onLeftFirstItem","onLeftLastItem","onCloseRootSubmenu","onExpandLastSubmenu"],vi=[Qe,et,tt,it],Be="dxcontextmenu",fi=We();class nt extends Ce{getShowEvent(e){var t=null;return w(e)?e.name!==null&&(t=e.name||Be):t=e,t}getShowDelay(e){return w(e)&&e.delay}_getDefaultOptions(){return u(super._getDefaultOptions(),{showEvent:Be,hideOnOutsideClick:!0,position:{at:"top left",my:"top left"},onShowing:null,onShown:null,onSubmenuCreated:null,onHiding:null,onHidden:null,onPositioning:null,submenuDirection:"auto",visible:!1,target:void 0,onLeftFirstItem:null,onLeftLastItem:null,onCloseRootSubmenu:null,onExpandLastSubmenu:null})}_defaultOptionsRules(){return super._defaultOptionsRules().concat([{device:()=>!te(),options:{animation:null}}])}_setDeprecatedOptions(){super._setDeprecatedOptions(),u(this._deprecatedOptions,{closeOnOutsideClick:{since:"22.2",alias:"hideOnOutsideClick"}})}_initActions(){this._actions={},h(Me,(e,t)=>{this._actions[t]=this._createActionByOption(t)||C})}_setOptionsByReference(){super._setOptionsByReference(),u(this._optionsByReference,{animation:!0,selectedItem:!0})}_focusInHandler(){}_itemContainer(){return this._overlay?this._overlay.$content():o()}_eventBindingTarget(){return this._itemContainer()}itemsContainer(){return this._overlay?this._overlay.$content():void 0}_supportedKeys(){return u(super._supportedKeys(),{space:()=>{var e=o(this.option("focusedElement"));this.hide(),!(!e.length||!this._isSelectionEnabled())&&this.selectItem(e[0])},escape:this.hide})}_getActiveItem(){var e=this._getAvailableItems(),t=e.filter(".".concat(ci)),n=e.filter(".".concat(we)),s=n.closest(".".concat(q));return s.find(".".concat(G)).index(t)>=0?t:n.length?n:super._getActiveItem()}_moveFocus(e){var t=this._getItemsByLocation(e),n=this._getActiveItem(!0),s=this.itemsContainer().find(".".concat(we)),a=o(this.option("focusedElement")),r=!!(a.length||s.length),l;switch(e){case Qe:l=r?this._prevItem(t):n,this._setFocusedElement(l),n.is(t.first())&&this._actions.onLeftFirstItem(n);break;case et:l=r?this._nextItem(t):n,this._setFocusedElement(l),n.is(t.last())&&this._actions.onLeftLastItem(n);break;case pi:l=this.option("rtlEnabled")?this._hideSubmenuHandler():this._expandSubmenuHandler(t,e),this._setFocusedElement(l);break;case mi:l=this.option("rtlEnabled")?this._expandSubmenuHandler(t,e):this._hideSubmenuHandler(),this._setFocusedElement(l);break;case tt:l=t.first(),this._setFocusedElement(l);break;case it:l=t.last(),this._setFocusedElement(l);break;default:return super._moveFocus(e)}}_setFocusedElement(e){e&&e.length!==0&&this.option("focusedElement",m(e))}_getItemsByLocation(e){var t=this._getActiveItem(!0),n;return vi.includes(e)&&(n=t.closest(".".concat(q)).children().children()),n=this._getAvailableItems(n),n}_getAriaTarget(){return this.$element()}_refreshActiveDescendant(){if(g(this._overlay)){var e=this._overlay.$content();super._refreshActiveDescendant(e)}}_hideSubmenuHandler(){var e=this._getActiveItem(!0),t=e.parents(".".concat(L)).first();return t.length?(this._hideSubmenusOnSameLevel(t),this._hideSubmenu(e.closest(".".concat(S))),t):(this._actions.onCloseRootSubmenu(e),e)}_expandSubmenuHandler(e,t){var n=this._getActiveItem(!0),s=this._getItemData(n),a=this._dataAdapter.getNodeByItem(s),r=this._hasSubmenu(a),l=n.children(".".concat(S));if(r&&!n.hasClass(ui))return(!l.length||l.css("visibility")==="hidden")&&this._showSubmenu(n),this._nextItem(this._getItemsByLocation(t));this._actions.onExpandLastSubmenu(n)}_clean(){this._overlay&&(this._overlay.$element().remove(),this._overlay=null),this._detachShowContextMenuEvents(this._getTarget()),super._clean()}_initMarkup(){this.$element().addClass(hi),super._initMarkup()}_render(){super._render(),this._renderVisibility(this.option("visible")),this._addWidgetClass()}_renderContentImpl(){this._detachShowContextMenuEvents(this._getTarget()),this._attachShowContextMenuEvents()}_attachKeyboardEvents(){!this._keyboardListenerId&&this._focusTarget().length&&super._attachKeyboardEvents()}_renderContextMenuOverlay(){if(!this._overlay){var e=this._getOverlayOptions();this._overlay=this._createComponent(o("<div>").appendTo(this._$element),Ue,e);var t=this._overlay.$content();t.addClass(di),this._addCustomCssClass(t),this._addPlatformDependentClass(t),this._attachContextMenuEvent()}}preventShowingDefaultContextMenuAboveOverlay(){var e=this._itemContainer(),t=I(kt,this.NAME);_.off(e,t,".".concat(S)),_.on(e,t,".".concat(S),(n=>{n.stopPropagation(),n.preventDefault(),_.off(e,t,".".concat(S))}).bind(this))}_itemContextMenuHandler(e){super._itemContextMenuHandler(e),e.stopPropagation()}_addPlatformDependentClass(e){ee.current().phone&&e.addClass(li)}_detachShowContextMenuEvents(e){var t=this.getShowEvent(this.option("showEvent"));if(t){var n=I(t,this.NAME);this._showContextMenuEventHandler?_.off(D.getDocument(),n,e,this._showContextMenuEventHandler):_.off(o(e),n)}}_attachShowContextMenuEvents(){var e=this._getTarget(),t=this.getShowEvent(this.option("showEvent"));if(t){var n=I(t,this.NAME),s=this._createAction(r=>{var l=this.getShowDelay(this.option("showEvent"));l?setTimeout(()=>this._show(r.event),l):this._show(r.event)},{validatingTargetName:"target"}),a=r=>s({event:r,target:o(r.currentTarget)});s=this._createAction(s),gt(e)||e.nodeType||St(e)?(this._showContextMenuEventHandler=void 0,_.on(e,n,a)):(this._showContextMenuEventHandler=a,_.on(D.getDocument(),n,e,this._showContextMenuEventHandler))}}_hoverEndHandler(e){super._hoverEndHandler(e),e.stopPropagation()}_renderDimensions(){}_renderContainer(e,t){var n=t||this._itemContainer();e=o("<div>"),e.appendTo(n).addClass(S).css("visibility",t?"hidden":"visible"),e.parent().hasClass(_i)||this._addCustomCssClass(e);var s=super._renderContainer(e);return t?s:this.option("width")?s.css("minWidth",this.option("width")):this.option("height")?s.css("minHeight",this.option("height")):s}_renderSubmenuItems(e,t){this._renderItems(this._getChildNodes(e),t),this._actions.onSubmenuCreated({itemElement:m(t),itemData:e.internalFields.item,submenuElement:m(t.children(".".concat(S)))})}_getOverlayOptions(){var e=this.option("position"),t={focusStateEnabled:this.option("focusStateEnabled"),animation:this.option("animation"),innerOverlay:!0,hideOnOutsideClick:n=>this._hideOnOutsideClickHandler(n),propagateOutsideClick:!0,hideOnParentScroll:!0,deferRendering:!1,position:{at:e.at,my:e.my,of:this._getTarget(),collision:"flipfit"},shading:!1,showTitle:!1,height:"auto",width:"auto",onShown:this._overlayShownActionHandler.bind(this),onHiding:this._overlayHidingActionHandler.bind(this),onHidden:this._overlayHiddenActionHandler.bind(this),visualContainer:fi};return t}_overlayShownActionHandler(e){this._actions.onShown(e)}_overlayHidingActionHandler(e){this._actions.onHiding(e),e.cancel||(this._hideAllShownSubmenus(),this._setOptionWithoutOptionChange("visible",!1))}_overlayHiddenActionHandler(e){this._actions.onHidden(e)}_shouldHideOnOutsideClick(e){var{closeOnOutsideClick:t,hideOnOutsideClick:n}=this.option();return k(n)?n(e):k(t)?t(e):n||t}_hideOnOutsideClickHandler(e){if(!this._shouldHideOnOutsideClick(e))return!1;if(D.isDocument(e.target))return!0;var t=this._getActiveItemsContainer(e.target),n=this._getItemsContainers(),s=this._searchActiveItem(e.target),a=this.$element().parents(".".concat(G)),r=s[0]===a[0]&&s.length&&a.length,l=this._isIncludeOverlay(t,n)&&s.length;return l||r?(this._getShowSubmenuMode()==="onClick"&&this._hideAllShownChildSubmenus(s),!1):!0}_getActiveItemsContainer(e){return o(e).closest(".".concat(q))}_getItemsContainers(){return this._overlay.$content().find(".".concat(q))}_searchActiveItem(e){return o(e).closest(".".concat(G)).eq(0)}_isIncludeOverlay(e,t){var n=!1;return h(t,(s,a)=>{e.is(a)&&!n&&(n=!0)}),n}_hideAllShownChildSubmenus(e){var t=e.find(".".concat(S)),n=u([],this._shownSubmenus);t.length>0&&h(n,(s,a)=>{var r=this._searchActiveItem(a.context).parent();r.parent().is(e.parent().parent())&&!r.is(e.parent())&&this._hideSubmenu(a)})}_showSubmenu(e){var t=this._dataAdapter.getNodeByItem(this._getItemData(e));if(this._hideSubmenusOnSameLevel(e),!!this._hasSubmenu(t)){var n=e.children(".".concat(S)),s=n.length;super._showSubmenu(e),s||this._renderSubmenuItems(t,e),this._isSubmenuVisible(n)||this._drawSubmenu(e)}}_hideSubmenusOnSameLevel(e){var t=e.parent(".".concat(ke)).siblings().find(".".concat(L));t.length&&(t.removeClass(L),this._hideSubmenu(t.find(".".concat(S))))}_hideSubmenuGroup(e){this._isSubmenuVisible(e)&&this._hideSubmenuCore(e)}_isSubmenuVisible(e){return e.css("visibility")==="visible"}_drawSubmenu(e){var t=this.option("animation")?this.option("animation").show:{},n=e.children(".".concat(S)),s=this._getSubmenuPosition(e);this._overlay&&this._overlay.option("visible")&&(g(this._shownSubmenus)||(this._shownSubmenus=[]),this._shownSubmenus.includes(n)||this._shownSubmenus.push(n),t&&H.stop(n),Xe.setup(n,s),t&&(ge(t.to)&&(t.to.position=s),this._animate(n,t)),n.css("visibility","visible"))}_animate(e,t){H.animate(e,t)}_getSubmenuPosition(e){var t=this.option("submenuDirection").toLowerCase(),n=e.parent(".".concat(ke)),s={collision:"flip",of:n,offset:{h:0,v:-1}};switch(t){case"left":s.at="left top",s.my="right top";break;case"right":s.at="right top",s.my="left top";break;default:this.option("rtlEnabled")?(s.at="left top",s.my="right top"):(s.at="right top",s.my="left top")}return s}_updateSubmenuVisibilityOnClick(e){if(e.args.length){var t=e.args[0].itemData,n=this._dataAdapter.getNodeByItem(t);if(n){var s=o(e.args[0].itemElement),a=s.find(".".concat(S)),r=this._hasSubmenu(n)&&!a.length;if(r&&(this._renderSubmenuItems(n,s),a=s.find(".".concat(S))),!(s.context===a.context&&a.css("visibility")==="visible")){this._updateSelectedItemOnClick(e);var l=t&&t.closeMenuOnClick===!1;if(!(!t||t.disabled||l))if(a.length===0){var d=o(s.parents(".".concat(S))[0]);this._hideSubmenu(d),!e.canceled&&this._overlay&&this._overlay.option("visible")&&this.option("visible",!1)}else this._shownSubmenus&&this._shownSubmenus.length>0&&this._shownSubmenus[0].is(a)&&this._hideSubmenu(a),this._showSubmenu(s)}}}}_hideSubmenu(e){var t=u([],this._shownSubmenus);h(t,(n,s)=>{(e.is(s)||dt(e[0],s[0]))&&(s.parent().removeClass(L),this._hideSubmenuCore(s))})}_hideSubmenuCore(e){var t=this._shownSubmenus.indexOf(e),n=this.option("animation")?this.option("animation").hide:null;t>=0&&this._shownSubmenus.splice(t,1),this._stopAnimate(e),n&&this._animate(e,n),e.css("visibility","hidden")}_stopAnimate(e){H.stop(e,!0)}_hideAllShownSubmenus(){var e=u([],this._shownSubmenus),t=this._overlay.$content().find(".".concat(L));t.removeClass(L),h(e,(n,s)=>{this._hideSubmenu(s)})}_visibilityChanged(e){e&&this._renderContentImpl()}_optionChanged(e){if(Me.includes(e.name)){this._initActions();return}switch(e.name){case"visible":this._renderVisibility(e.value);break;case"showEvent":case"position":case"submenuDirection":this._invalidate();break;case"target":e.previousValue&&this._detachShowContextMenuEvents(e.previousValue),this._invalidate();break;case"closeOnOutsideClick":case"hideOnOutsideClick":break;default:super._optionChanged(e)}}_renderVisibility(e){return e?this._show():this._hide()}_toggleVisibility(){}_show(e){var t={jQEvent:e},n=new v().reject().promise();if(this._actions.onShowing(t),t.cancel)return n;var s=this._positionContextMenu(e);if(s){var a;this._overlay||(this._renderContextMenuOverlay(),this._overlay.$content().addClass(this._widgetClass()),this._renderFocusState(),this._attachHoverEvents(),this._attachClickEvent(),this._renderItems(this._dataAdapter.getRootNodes())),this._setOptionWithoutOptionChange("visible",!0),this._overlay.option("position",s),n=this._overlay.show(),e&&e.stopPropagation(),this._setAriaAttributes(),(e==null||(a=e.originalEvent)===null||a===void 0?void 0:a.type)===wt.name&&this.preventShowingDefaultContextMenuAboveOverlay()}return n}_setAriaAttributes(){this._overlayContentId="dx-".concat(new Ct),this.setAria("owns",this._overlayContentId),this.setAria({id:this._overlayContentId,role:"menu"},this._overlay.$content())}_cleanAriaAttributes(){this._overlay&&this.setAria("id",null,this._overlay.$content()),this.setAria("owns",void 0)}_getTarget(){return this.option("target")||this.option("position").of||o(D.getDocument())}_getContextMenuPosition(){return u({},this.option("position"),{of:this._getTarget()})}_positionContextMenu(e){var t=this._getContextMenuPosition(),n=this._isInitialOptionValue("position"),s=this._createActionByOption("onPositioning");e&&e.preventDefault&&n&&(t.of=e);var a={position:t,event:e};return s(a),a.cancel?t=null:a.event&&(a.event.cancel=!0,e.preventDefault()),t}_refresh(){if(!te())super._refresh();else if(this._overlay){var e=this._overlay.option("position");super._refresh(),this._overlay&&this._overlay.option("position",e)}else super._refresh()}_hide(){var e;return this._overlay&&(e=this._overlay.hide(),this._setOptionWithoutOptionChange("visible",!1)),this._cleanAriaAttributes(),this.option("focusedElement",null),e||new v().reject().promise()}toggle(e){var t=this.option("visible");return e=e===void 0?!t:e,this._renderVisibility(e)}show(){return this.toggle(!0)}hide(){return this.toggle(!1)}}ve("dxContextMenu",nt);var y="dx-treeview",f="".concat(y,"-node"),A="".concat(f,"-container"),re="".concat(f,"-loadindicator"),x="".concat(f,"-container-opened"),P="".concat(f,"-is-leaf"),p="".concat(y,"-item"),gi="".concat(p,"-with-checkbox"),Si="".concat(p,"-with-custom-expander-icon"),Ci="".concat(y,"-custom-expander-icon-item-container"),bi="".concat(p,"-without-checkbox"),Ei="".concat(p,"-data"),$="".concat(y,"-toggle-item-visibility"),oe="".concat(y,"-custom-collapse-icon"),le="".concat(y,"-custom-expand-icon"),Ii="".concat(y,"-loadindicator"),yi="".concat(y,"-loadindicator-wrapper"),Le="".concat(y,"-toggle-item-visibility-opened"),j="".concat(y,"-select-all-item"),Fe="dx-state-invisible",U="dx-state-disabled",Ai="dx-state-selected",de="dxTreeView_expand",Y="data-item-id",Ni="dx-item-url",xi=je.inherit({_supportedKeys:function(i){var e=s=>{var a=o(this.option("focusedElement"));if(a.length){s.target=a,s.currentTarget=a,this._itemClickHandler(s,a.children("."+p));var r=this._getEventNameByOption(this.option("expandEvent")),l=r===I(W,de);l&&this._expandEventHandler(s)}},t=s=>{s.preventDefault();var a=o(this.option("focusedElement")),r=this._getCheckBoxInstance(a);if(!r.option("disabled")){var l=r.option("value");this._updateItemSelection(!l,a.find("."+p).get(0),!0)}},n=function(s,a){if(this.option("expandAllEnabled")){a.preventDefault();var r=o(this.option("focusedElement"));if(r.length){var l=this._getItemData(r.find(".".concat(p)));this._toggleExpandedNestedItems([l],s)}}};return u(this.callBase(),{enter:this._showCheckboxes()?t:e,space:this._showCheckboxes()?t:e,asterisk:n.bind(this,!0),minus:n.bind(this,!1)})},_toggleExpandedNestedItems:function(i,e){if(i)for(var t=0,n=i.length;t<n;t++){var s=i[t],a=this._dataAdapter.getNodeByItem(s);this._toggleExpandedState(a,e),this._toggleExpandedNestedItems(s.items,e)}},_getNodeElement:function(i,e){var t=this._encodeString(i.internalFields.key);if(e)return e.$nodeByKey||(e.$nodeByKey={},this.$element().find(".".concat(f)).each(function(){var s=o(this),a=s.attr(Y);e.$nodeByKey[a]=s})),e.$nodeByKey[t]||o();var n=this.$element().get(0).querySelector("[".concat(Y,'="').concat(t,'"]'));return o(n)},_activeStateUnit:"."+p,_widgetClass:function(){return y},_getDefaultOptions:function(){var i=u(this.callBase(),{animationEnabled:!0,dataStructure:"tree",deferRendering:!0,expandAllEnabled:!1,hasItemsExpr:"hasItems",selectNodesRecursive:!0,expandNodesRecursive:!0,showCheckBoxesMode:"none",expandIcon:null,collapseIcon:null,selectAllText:bt.format("dxList-selectAll"),onItemSelectionChanged:null,onItemExpanded:null,onItemCollapsed:null,scrollDirection:"vertical",useNativeScrolling:!0,virtualModeEnabled:!1,rootValue:0,focusStateEnabled:!1,selectionMode:"multiple",expandEvent:"dblclick",selectByClick:!1,createChildren:null,onSelectAllValueChanged:null});return u(!0,i,{integrationOptions:{useDeferUpdateForTemplates:!1}})},_defaultOptionsRules:function(){return this.callBase().concat([{device:function(){return!ht},options:{useNativeScrolling:!1}}])},_initSelectedItems:C,_syncSelectionOptions:ze,_fireSelectionChanged:function(){var i=this._selectionChangePromise;Ae(i).done((function(){this._createActionByOption("onSelectionChanged",{excludeValidators:["disabled","readOnly"]})()}).bind(this))},_createSelectAllValueChangedAction:function(){this._selectAllValueChangedAction=this._createActionByOption("onSelectAllValueChanged",{excludeValidators:["disabled","readOnly"]})},_fireSelectAllValueChanged:function(i){this._selectAllValueChangedAction({value:i})},_checkBoxModeChange:function(i,e){var t=this.option("searchEnabled"),n=this._selectAllEnabled(e),s=this._itemContainer(t,n);if(this._detachClickEvent(s),this._detachExpandEvent(s),!(e==="none"||i==="none")){var a=this._$selectAllItem&&this._$selectAllItem.length;switch(i){case"selectAll":a||(this._createSelectAllValueChangedAction(),this._renderSelectAllItem());break;case"normal":a&&(this._$selectAllItem.remove(),delete this._$selectAllItem)}}},_removeSelection:function(){var i=this;h(this._dataAdapter.getFullData(),function(e,t){i._hasChildren(t)&&i._dataAdapter.toggleSelection(t.internalFields.key,!1,!0)})},_optionChanged:function(i){var{name:e,value:t,previousValue:n}=i;switch(e){case"selectAllText":this._$selectAllItem&&this._$selectAllItem.dxCheckBox("instance").option("text",t);break;case"showCheckBoxesMode":this._checkBoxModeChange(t,n),this._invalidate();break;case"scrollDirection":this.getScrollable().option("direction",t);break;case"useNativeScrolling":this.getScrollable().option("useNative",t);break;case"items":delete this._$selectAllItem,this.callBase(i);break;case"dataSource":this.callBase(i),this._initDataAdapter(),this._filter={};break;case"hasItemsExpr":this._initAccessors(),this.repaint();break;case"expandEvent":this._attachExpandEvent();break;case"deferRendering":case"dataStructure":case"rootValue":case"createChildren":case"expandNodesRecursive":case"onItemSelectionChanged":case"onItemExpanded":case"onItemCollapsed":case"expandAllEnabled":case"animationEnabled":case"virtualModeEnabled":case"selectByClick":break;case"selectionMode":this._initDataAdapter(),this.callBase(i);break;case"onSelectAllValueChanged":this._createSelectAllValueChangedAction();break;case"selectNodesRecursive":this._dataAdapter.setOption("recursiveSelection",i.value),this.repaint();break;case"expandIcon":case"collapseIcon":this.repaint();break;default:this.callBase(i)}},_initDataSource:function(){this._useCustomChildrenLoader()?this._loadChildrenByCustomLoader(null).done((function(i){i&&i.length&&this.option("items",i)}).bind(this)):(this.callBase(),this._isVirtualMode()&&this._initVirtualMode())},_initVirtualMode:function(){var i=this._filter;i.custom||(i.custom=this._dataSource.filter()),i.internal||(i.internal=[this.option("parentIdExpr"),this.option("rootValue")])},_useCustomChildrenLoader:function(){return k(this.option("createChildren"))&&this._isDataStructurePlain()},_loadChildrenByCustomLoader:function(i){var e=this.option("createChildren").call(this,i);return Array.isArray(e)?new v().resolve(e).promise():e&&k(e.then)?Et(e):new v().resolve([]).promise()},_combineFilter:function(){return!this._filter.custom||!this._filter.custom.length?this._filter.internal:[this._filter.custom,this._filter.internal]},_dataSourceLoadErrorHandler:function(){this._renderEmptyMessage()},_init:function(){this._filter={},this.callBase(),this._initStoreChangeHandlers()},_dataSourceChangedHandler:function(i){var e=this.option("items");this._initialized&&this._isVirtualMode()&&e.length||this.option("items",i)},_removeTreeViewLoadIndicator:function(){this._treeViewLoadIndicator&&(this._treeViewLoadIndicator.remove(),this._treeViewLoadIndicator=null)},_createTreeViewLoadIndicator:function(){return this._treeViewLoadIndicator=o("<div>").addClass(Ii),this._createComponent(this._treeViewLoadIndicator,ne,{}),this._treeViewLoadIndicator},_dataSourceLoadingChangedHandler:function(i){var e;if(this._isVirtualMode()&&(e=this._combineFilter(),this._dataSource.filter(e)),i&&!this._dataSource.isLoaded()){this.option("items",[]);var t=o("<div>").addClass(yi);this._createTreeViewLoadIndicator().appendTo(t),this.itemsContainer().append(t),this._isVirtualMode()&&this._dataSource.filter()!==e&&this._dataSource.filter([])}else this._removeTreeViewLoadIndicator()},_initStoreChangeHandlers:function(){this.option("dataStructure")==="plain"&&this._dataSource&&this._dataSource.store().on("inserted",i=>{this.option().items=this.option("items").concat(i),this._dataAdapter.addItem(i),this._dataAdapter.isFiltered(i)&&this._updateLevel(this._parentIdGetter(i))}).on("removed",i=>{var e=this._dataAdapter.getNodeByKey(i);g(e)&&(this.option("items")[this._dataAdapter.getIndexByKey(e.internalFields.key)]=0,this._markChildrenItemsToRemove(e),this._removeItems(),this._dataAdapter.removeItem(i),this._updateLevel(this._parentIdGetter(e)))})},_markChildrenItemsToRemove:function(i){var e=i.internalFields.childrenKeys;h(e,(t,n)=>{this.option("items")[this._dataAdapter.getIndexByKey(n)]=0,this._markChildrenItemsToRemove(this._dataAdapter.getNodeByKey(n))})},_removeItems:function(){var i=u(!0,[],this.option("items")),e=0;h(i,(t,n)=>{n||(this.option("items").splice(t-e,1),e++)})},_updateLevel:function(i){var e=this._getContainerByParentKey(i);this._renderItems(e,this._dataAdapter.getChildrenNodes(i))},_getOldContainer:function(i){if(i.length)return i.children(".".concat(A));var e=this.getScrollable();return e?o(e.content()).children():o()},_getContainerByParentKey:function(i){var e=this._dataAdapter.getNodeByKey(i),t=e?this._getNodeElement(e):[];this._getOldContainer(t).remove();var n=this._renderNodeContainer(t);if(this._isRootLevel(i)){var s=this.getScrollable();s||this._renderScrollableContainer(),o(s.content()).append(n)}return n},_isRootLevel:function(i){return i===this.option("rootValue")},_getAccessors:function(){var i=this.callBase();return i.push("hasItems"),i},_getDataAdapterOptions:function(){var i,e,t;return{rootValue:this.option("rootValue"),multipleSelection:!this._isSingleSelection(),recursiveSelection:this._isRecursiveSelection(),recursiveExpansion:this.option("expandNodesRecursive"),selectionRequired:this.option("selectionRequired"),dataType:this.option("dataStructure"),sort:this._dataSource&&this._dataSource.sort(),langParams:(i=this._dataSource)===null||i===void 0||(e=i.loadOptions)===null||e===void 0||(t=e.call(i))===null||t===void 0?void 0:t.langParams}},_initMarkup:function(){this._renderScrollableContainer(),this._renderEmptyMessage(this._dataAdapter.getRootNodes()),this.callBase(),this.setAria("role","tree")},_renderContentImpl:function(){var i=this._renderNodeContainer();o(this.getScrollable().content()).append(i),!(!this.option("items")||!this.option("items").length)&&(this._renderItems(i,this._dataAdapter.getRootNodes()),this._attachExpandEvent(),this._selectAllEnabled()&&(this._createSelectAllValueChangedAction(),this._renderSelectAllItem(i)))},_isVirtualMode:function(){return this.option("virtualModeEnabled")&&this._isDataStructurePlain()&&!!this.option("dataSource")},_isDataStructurePlain:function(){return this.option("dataStructure")==="plain"},_fireContentReadyAction:function(){var i=this.getDataSource(),e=i&&!i.isLoaded()||this._skipContentReadyAndItemExpanded,t=this.getScrollable();t&&te()&&t.update(),e||this.callBase(),t&&te()&&t.update()},_renderScrollableContainer:function(){this._scrollable=this._createComponent(o("<div>").appendTo(this.$element()),Mt,{useNative:this.option("useNativeScrolling"),direction:this.option("scrollDirection"),useKeyboard:!1})},_renderNodeContainer:function(i){var e=o("<ul>").addClass(A);if(this.setAria("role","group",e),i&&i.length){var t=this._getItemData(i.children("."+p));this._expandedGetter(t)&&e.addClass(x),e.appendTo(i)}return e},_createDOMElement:function(i,e){var t,n,s=o("<li>").addClass(f).attr(Y,this._encodeString(e.internalFields.key)).prependTo(i),a={role:"treeitem",label:this._displayGetter(e.internalFields.item)||"",level:this._getLevel(i)},r=!!(e!=null&&(t=e.internalFields)!==null&&t!==void 0&&(n=t.childrenKeys)!==null&&n!==void 0&&n.length);return r&&(a.expanded=e.internalFields.expanded||!1),this.setAria(a,s),s},_getLevel:function(i){var e=i.parent();return e.hasClass("dx-scrollable-content")?1:parseInt(e.attr("aria-level"))+1},_showCheckboxes:function(){return this.option("showCheckBoxesMode")!=="none"},_hasCustomExpanderIcons:function(){return this.option("expandIcon")||this.option("collapseIcon")},_selectAllEnabled:function(i){var e=i??this.option("showCheckBoxesMode");return e==="selectAll"&&!this._isSingleSelection()},_renderItems:function(i,e){for(var t=e.length-1,n=t;n>=0;n--)this._renderItem(n,e[n],i);this._renderedItemsCount+=e.length},_renderItem:function(i,e,t){var n=this._createDOMElement(t,e),s=e.internalFields,a=this._showCheckboxes();n.addClass(a?gi:bi),n.toggleClass(Fe,s.item.visible===!1),this._hasCustomExpanderIcons()&&(n.addClass(Si),t.addClass(Ci)),a&&this._renderCheckBox(n,e),this.setAria("selected",s.selected,n),this._toggleSelectedClass(n,s.selected),s.disabled&&this.setAria("disabled",s.disabled,n),this.callBase(this._renderedItemsCount+i,s.item,n),s.item.visible!==!1&&this._renderChildren(n,e)},_setAriaSelectionAttribute:C,_renderChildren:function(i,e){if(!this._hasChildren(e)){this._addLeafClass(i);return}this._hasCustomExpanderIcons()?this._renderCustomExpanderIcons(i,e):this._renderDefaultExpanderIcons(i,e),!(this.option("deferRendering")&&!e.internalFields.expanded)&&this._loadSublevel(e).done(t=>{this._renderSublevel(i,this._getActualNode(e),t)})},_getActualNode:function(i){return this._dataAdapter.getNodeByKey(i.internalFields.key)},_hasChildren:function(i){return this._isVirtualMode()||this._useCustomChildrenLoader()?this._hasItemsGetter(i.internalFields.item)!==!1:this.callBase(i)},_loadSublevel:function(i){var e=new v,t=this._getChildNodes(i);return t.length?e.resolve(t):this._loadNestedItems(i).done(n=>{e.resolve(this._dataAdapter.getNodesByItems(n))}),e.promise()},_getItemExtraPropNames:()=>["url","linkAttr"],_addContent:function(i,e){var{html:t,url:n}=e;if(n){i.html(t);var s=this._getLinkContainer(this._getIconContainer(e),this._getTextContainer(e),e);i.append(s)}else this.callBase(i,e)},_renderSublevel:function(i,e,t){var n=this._renderNodeContainer(i,e),s=t.filter(r=>e.internalFields.childrenKeys.indexOf(r.internalFields.key)!==-1);if(this._renderItems(n,s),s.length&&!e.internalFields.selected){var a=s[0];this._updateParentsState(a,this._getNodeElement(a))}this._normalizeIconState(i,s.length),e.internalFields.expanded&&n.addClass(x)},_executeItemRenderAction:function(i,e,t){var n=this._getNode(t);this._getItemRenderAction()({itemElement:t,itemIndex:i,itemData:e,node:this._dataAdapter.getPublicNode(n)})},_addLeafClass:function(i){i.addClass(P)},_expandEventHandler:function(i){var e=o(i.currentTarget.parentNode);e.hasClass(P)||this._toggleExpandedState(i.currentTarget,void 0,i)},_attachExpandEvent:function(){var i=this._getEventNameByOption(this.option("expandEvent")),e=this._itemContainer();this._detachExpandEvent(e),_.on(e,i,this._itemSelector(),this._expandEventHandler.bind(this))},_detachExpandEvent(i){_.off(i,".".concat(de),this._itemSelector())},_getEventNameByOption:function(i){var e=i==="click"?W:Se;return I(e,de)},_getNode:function(i){if(!g(i))return null;if(i.internalFields)return i;if(Z(i))return this._dataAdapter.getNodeByKey(i);var e=o(i).get(0);return e?D.isElementNode(e)?this._getNodeByElement(e):this._dataAdapter.getNodeByItem(e):null},_getNodeByElement:function(i){var e=o(i).closest("."+f),t=this._decodeString(e.attr(Y));return this._dataAdapter.getNodeByKey(t)},_toggleExpandedState:function(i,e,t){var n=this._getNode(i);if(!n)return new v().reject().promise();if(n.internalFields.disabled)return new v().reject().promise();var s=n.internalFields.expanded;if(s===e)return new v().resolve().promise();if(this._hasChildren(n)){var a=this._getNodeElement(n);if(a.find(".".concat(re,":not(.").concat(Fe,")")).length)return new v().reject().promise();!s&&!this._nodeHasRenderedChildren(a)&&this._createLoadIndicator(a)}return g(e)||(e=!s),this._dataAdapter.toggleExpansion(n.internalFields.key,e),this._updateExpandedItemsUI(n,e,t)},_nodeHasRenderedChildren(i){var e=i.children(".".concat(A));return e.not(":empty").length},_createLoadIndicator:function(i){this._createComponent(o("<div>").addClass(re),ne,{}).$element().appendTo(i);var e=i.children(".".concat($,",.").concat(le));e.hide()},_renderExpanderIcon:function(i,e,t,n){t.appendTo(i),t.addClass(n),e.internalFields.disabled&&t.addClass(U),this._renderToggleItemVisibilityIconClick(t,e)},_renderDefaultExpanderIcons:function(i,e){var t=o("<div>").addClass($).appendTo(i);e.internalFields.expanded&&(t.addClass(Le),i.parent().addClass(x)),e.internalFields.disabled&&t.addClass(U),this._renderToggleItemVisibilityIconClick(t,e)},_renderCustomExpanderIcons:function(i,e){var{expandIcon:t,collapseIcon:n}=this.option(),s=me(t??n),a=me(n??t);this._renderExpanderIcon(i,e,s,le),this._renderExpanderIcon(i,e,a,oe);var r=e.internalFields.expanded;r&&i.parent().addClass(x),this._toggleCustomExpanderIcons(s,a,r)},_renderToggleItemVisibilityIconClick:function(i,e){var t=I(W,this.NAME);_.off(i,t),_.on(i,t,n=>{this._toggleExpandedState(e.internalFields.key,void 0,n)})},_toggleCustomExpanderIcons:function(i,e,t){e.toggle(t),i.toggle(!t)},_updateExpandedItemsUI:function(i,e,t){var n=this._getNodeElement(i),s=!n.length||e&&n.is(":hidden");if(this.option("expandNodesRecursive")&&s){var a=this._getNode(i.internalFields.parentKey);a&&this._updateExpandedItemsUI(a,e,t)}if(this._hasCustomExpanderIcons()){if(this._nodeHasRenderedChildren(n)){var l=n.children(".".concat(le)),d=n.children(".".concat(oe));this._toggleCustomExpanderIcons(l,d,e)}}else{var r=n.children(".".concat($));r.toggleClass(Le,e)}var c=n.children(".".concat(A)),N=c.length>0,b=new v;return!e||N&&!c.is(":empty")?(this._animateNodeContainer(i,e,t,b),b.promise()):i.internalFields.childrenKeys.length===0&&(this._isVirtualMode()||this._useCustomChildrenLoader())?(this._loadNestedItemsWithUpdate(i,e,t,b),b.promise()):(this._renderSublevel(n,i,this._getChildNodes(i)),this._fireContentReadyAction(),this._animateNodeContainer(i,e,t,b),b.promise())},_loadNestedItemsWithUpdate:function(i,e,t,n){var s=this._getNodeElement(i);this._loadNestedItems(i).done(a=>{var r=this._getActualNode(i);if(this._renderSublevel(s,r,this._dataAdapter.getNodesByItems(a)),!a||!a.length){n.resolve();return}this._fireContentReadyAction(),this._animateNodeContainer(r,e,t,n)})},_loadNestedItems:function(i){if(this._useCustomChildrenLoader()){var e=this._dataAdapter.getPublicNode(i);return this._loadChildrenByCustomLoader(e).done(t=>{this._areNodesExists(t)||this._appendItems(t)})}return this._isVirtualMode()?(this._filter.internal=[this.option("parentIdExpr"),i.internalFields.key],this._dataSource.filter(this._combineFilter()),this._dataSource.load().done(t=>{this._areNodesExists(t)||this._appendItems(t)})):new v().resolve([]).promise()},_areNodesExists:function(i,e){var t=this.keyOf(i[0]),n=this._dataAdapter.getFullData();return!!this._dataAdapter.getNodeByKey(t,n)},_appendItems:function(i){this.option().items=this.option("items").concat(i),this._initDataAdapter()},_animateNodeContainer:function(i,e,t,n){var s=this._getNodeElement(i),a=s.children(".".concat(A));i&&n&&a.length===0&&n.resolve(),a.addClass(x);var r=_e(a);H.stop(a,!0),H.animate(a,{type:"custom",duration:this.option("animationEnabled")?400:0,from:{maxHeight:e?0:r},to:{maxHeight:e?r:0},complete:(function(){a.css("maxHeight","none"),a.toggleClass(x,e),this.setAria("expanded",e,s),this.getScrollable().update(),this._fireExpandedStateUpdatedEvent(e,i,t),n&&n.resolve()}).bind(this)})},_fireExpandedStateUpdatedEvent:function(i,e,t){if(!(!this._hasChildren(e)||this._skipContentReadyAndItemExpanded)){var n=i?"onItemExpanded":"onItemCollapsed";if(g(t))this._itemDXEventHandler(t,n,{node:this._dataAdapter.getPublicNode(e)});else{var s=this._getNodeElement(e);this._itemEventHandler(s,n,{event:t,node:this._dataAdapter.getPublicNode(e)})}}},_normalizeIconState:function(i,e){var t=i.find(".".concat(re));if(t.length){var n;(n=ne.getInstance(t))===null||n===void 0||n.option("visible",!1)}var s=i.children(".".concat(oe,",.").concat($));if(e){s.show();return}s.removeClass($),i.addClass(P)},_emptyMessageContainer:function(){var i=this.getScrollable();return i?o(i.content()):this.callBase()},_renderContent:function(){var i=this.option("items");i&&i.length&&(this._contentAlreadyRendered=!0),this.callBase()},_renderSelectAllItem:function(i){i=i||this.$element().find(".".concat(A)).first(),this._$selectAllItem=o("<div>").addClass(j);var e=this._dataAdapter.isAllSelected();this._createComponent(this._$selectAllItem,xe,{value:e,elementAttr:{"aria-label":"Select All"},text:this.option("selectAllText"),onValueChanged:this._onSelectAllCheckboxValueChanged.bind(this)}),this._toggleSelectedClass(this._$selectAllItem,e),i.before(this._$selectAllItem)},_onSelectAllCheckboxValueChanged:function(i){this._toggleSelectAll(i),this._fireSelectAllValueChanged(i.value)},_toggleSelectAll:function(i){this._dataAdapter.toggleSelectAll(i.value),this._updateItemsUI(),this._fireSelectionChanged()},_renderCheckBox:function(i,e){var t=o("<div>").appendTo(i);this._createComponent(t,xe,{value:e.internalFields.selected,onValueChanged:this._changeCheckboxValue.bind(this),focusStateEnabled:!1,elementAttr:{"aria-label":"Check State"},disabled:this._disabledGetter(e)})},_toggleSelectedClass:function(i,e){i.toggleClass(Ai,!!e)},_toggleNodeDisabledState:function(i,e){var t=this._getNodeElement(i),n=t.find("."+p).eq(0);if(this._dataAdapter.toggleNodeDisabledState(i.internalFields.key,e),n.toggleClass(U,!!e),this._showCheckboxes()){var s=this._getCheckBoxInstance(t);s.option("disabled",!!e)}},_itemOptionChanged:function(i,e,t){var n=this._dataAdapter.getNodeByItem(i);e===this.option("disabledExpr")&&this._toggleNodeDisabledState(n,t)},_changeCheckboxValue:function(i){var e=o(i.element).parent("."+f),t=e.children("."+p),n=this._getItemData(t),s=this._getNodeByElement(t),a=i.value;s&&s.internalFields.selected===a||this._updateItemSelection(a,n,i.event)},_isSingleSelection:function(){return this.option("selectionMode")==="single"},_isRecursiveSelection:function(){return this.option("selectNodesRecursive")&&this.option("selectionMode")!=="single"},_isLastSelectedBranch:function(i,e,t){var n=e.indexOf(i.key);return n>=0&&e.splice(n,1),t&&h(i.children,(function(s,a){this._isLastSelectedBranch(a,e,!0)}).bind(this)),i.parent&&this._isLastSelectedBranch(i.parent,e),e.length===0},_isLastRequired:function(i){var e=this.option("selectionRequired"),t=this._isSingleSelection(),n=this.getSelectedNodeKeys();if(e)return t?n.length===1:this._isLastSelectedBranch(i.internalFields.publicNode,n.slice(),!0)},_updateItemSelection:function(i,e,t){var n=this._getNode(e);if(!n||n.visible===!1)return!1;if(n.internalFields.selected===i)return!0;if(!i&&this._isLastRequired(n)){if(this._showCheckboxes()){var s=this._getNodeElement(n);this._getCheckBoxInstance(s).option("value",!0)}return!1}if(i&&this._isSingleSelection()){var a=this.getSelectedNodeKeys();h(a,(d,c)=>{this._dataAdapter.toggleSelection(c,!1),this._updateItemsUI(),this._fireItemSelectionChanged(this._getNode(c))})}this._dataAdapter.toggleSelection(n.internalFields.key,i);var r=this._dataAdapter.isAllSelected(),l=this._selectAllEnabled()&&this._$selectAllItem.dxCheckBox("instance").option("value")!==r;return this._updateItemsUI(),this._fireItemSelectionChanged(n,t),this._fireSelectionChanged(),l&&this._fireSelectAllValueChanged(r),!0},_fireItemSelectionChanged:function(i,e){var t=e||this._findItemElementByItem(i.internalFields.item),n=e?this._itemDXEventHandler:this._itemEventHandler;n.call(this,t,"onItemSelectionChanged",{node:this._dataAdapter.getPublicNode(i),itemData:i.internalFields.item})},_getCheckBoxInstance:function(i){return i.children(".dx-checkbox").dxCheckBox("instance")},_updateItemsUI:function(){var i={};if(h(this._dataAdapter.getData(),(t,n)=>{var s=this._getNodeElement(n,i),a=n.internalFields.selected;s.length&&(this._toggleSelectedClass(s,a),this.setAria("selected",a,s),this._showCheckboxes()&&this._getCheckBoxInstance(s).option("value",a))}),this._selectAllEnabled()){var e=this._$selectAllItem.dxCheckBox("instance");e.option("onValueChanged",void 0),e.option("value",this._dataAdapter.isAllSelected()),e.option("onValueChanged",this._onSelectAllCheckboxValueChanged.bind(this))}},_updateParentsState:function(i,e){if(e){var t=this._dataAdapter.getNodeByKey(i.internalFields.parentKey),n=o(e.parents("."+f)[0]);if(this._showCheckboxes()){var s=t.internalFields.selected;this._getCheckBoxInstance(n).option("value",s),this._toggleSelectedClass(n,s)}t.internalFields.parentKey!==this.option("rootValue")&&this._updateParentsState(t,n)}},_itemEventHandlerImpl:function(i,e,t){var n=o(i).closest("."+f).children("."+p);return e(u(this._extendActionArgs(n),t))},_itemContextMenuHandler:function(i){this._createEventHandler("onItemContextMenu",i)},_itemHoldHandler:function(i){this._createEventHandler("onItemHold",i)},_createEventHandler:function(i,e){var t=this._getNodeByElement(e.currentTarget);this._itemDXEventHandler(e,i,{node:this._dataAdapter.getPublicNode(t)})},_itemClass:function(){return p},_itemDataKey:function(){return Ei},_attachClickEvent:function(){var i=this._itemContainer();this._detachClickEvent(i);var{clickEventNamespace:e,itemSelector:t,pointerDownEventNamespace:n,nodeSelector:s}=this._getItemClickEventData();_.on(i,e,t,a=>{this._itemClickHandler(a,o(a.currentTarget))}),_.on(i,n,s,a=>{this._itemPointerDownHandler(a)})},_detachClickEvent:function(i){var{clickEventNamespace:e,itemSelector:t,pointerDownEventNamespace:n,nodeSelector:s}=this._getItemClickEventData();_.off(i,e,t),_.off(i,n,s)},_getItemClickEventData:function(){var i=".".concat(this._itemClass()),e=".".concat(f,", .").concat(j),t=I(W,this.NAME),n=I(Ge.down,this.NAME);return{clickEventNamespace:t,itemSelector:i,pointerDownEventNamespace:n,nodeSelector:e}},_itemClick:function(i){var e=i.args[0],t=e.event.target[0]||e.event.target,n=t.getElementsByClassName(Ni)[0];e.itemData.url&&n&&n.click()},_itemClickHandler:function(i,e){var t=this._getItemData(e),n=this._getNodeByElement(e);this._itemDXEventHandler(i,"onItemClick",{node:this._dataAdapter.getPublicNode(n)},{beforeExecute:this._itemClick}),this.option("selectByClick")&&!i.isDefaultPrevented()&&this._updateItemSelection(!n.internalFields.selected,t,i)},_updateSelectionToFirstItem:function(i,e){for(var t=e;t>=0;){var n=o(i[t]);this._updateItemSelection(!0,n.find("."+p).get(0)),t--}},_updateSelectionToLastItem:function(i,e){for(var t=i.length,n=e;n<t;){var s=o(i[n]);this._updateItemSelection(!0,s.find("."+p).get(0)),n++}},focus:function(){if(this._selectAllEnabled()){_.trigger(this._$selectAllItem,"focus");return}this.callBase()},_focusInHandler:function(i){this._updateFocusState(i,!0);var e=o(i.target).hasClass(j);if(e||this.option("focusedElement")){clearTimeout(this._setFocusedItemTimeout),this._setFocusedItemTimeout=setTimeout(()=>{var n=e?m(this._$selectAllItem):o(this.option("focusedElement"));this._setFocusedItem(n)});return}var t=this._getActiveItem();this.option("focusedElement",m(t.closest("."+f)))},_itemPointerDownHandler:function(i){if(this.option("focusStateEnabled")){var e=o(i.target).closest("."+f+", ."+j);if(e.length){var t=e.hasClass(U)?null:e;this.option("focusedElement",m(t))}}},_findNonDisabledNodes:function(i){return i.not(function(){return o(this).children("."+p).hasClass(U)})},_moveFocus:function(i,e){var t="up",n="down",s="first",a="last",r=this.option("rtlEnabled")?"right":"left",l=this.option("rtlEnabled")?"left":"right";this.$element().find(".".concat(A)).each(function(){H.stop(this,!0)});var d=this._nodeElements();if(!(!d||!d.length))switch(i){case t:var c=this._prevItem(d);this.option("focusedElement",m(c));var N=this._getNodeItemElement(c);this.getScrollable().scrollToElement(N),e.shiftKey&&this._showCheckboxes()&&this._updateItemSelection(!0,N);break;case n:var b=this._nextItem(d);this.option("focusedElement",m(b));var K=this._getNodeItemElement(b);this.getScrollable().scrollToElement(K),e.shiftKey&&this._showCheckboxes()&&this._updateItemSelection(!0,K);break;case s:var R=d.first();e.shiftKey&&this._showCheckboxes()&&this._updateSelectionToFirstItem(d,d.index(this._prevItem(d))),this.option("focusedElement",m(R)),this.getScrollable().scrollToElement(this._getNodeItemElement(R));break;case a:var V=d.last();e.shiftKey&&this._showCheckboxes()&&this._updateSelectionToLastItem(d,d.index(this._nextItem(d))),this.option("focusedElement",m(V)),this.getScrollable().scrollToElement(this._getNodeItemElement(V));break;case l:this._expandFocusedContainer();break;case r:this._collapseFocusedContainer();break;default:this.callBase.apply(this,arguments);return}},_getNodeItemElement:function(i){return i.find("."+p).get(0)},_nodeElements:function(){return this.$element().find("."+f).not(":hidden")},_expandFocusedContainer:function(){var i=o(this.option("focusedElement"));if(!(!i.length||i.hasClass(P))){var e=i.find(".".concat(A)).eq(0);if(e.hasClass(x)){var t=this._nextItem(this._findNonDisabledNodes(this._nodeElements()));this.option("focusedElement",m(t)),this.getScrollable().scrollToElement(this._getNodeItemElement(t));return}var n=this._getNodeByElement(i.children("."+p));this._toggleExpandedState(n,!0)}},_getClosestNonDisabledNode:function(i){do i=i.parent().closest("."+f);while(i.children(".dx-treeview-item.dx-state-disabled").length);return i},_collapseFocusedContainer:function(){var i=o(this.option("focusedElement"));if(i.length){var e=i.find(".".concat(A)).eq(0);if(!i.hasClass(P)&&e.hasClass(x)){var t=this._getNodeByElement(i.children("."+p));this._toggleExpandedState(t,!1)}else{var n=this._getClosestNonDisabledNode(i);n.length&&this.option("focusedElement",m(n)),this.getScrollable().scrollToElement(this._getNodeItemElement(n))}}},_encodeString:function(i){return Ne(i)?encodeURI(i):i},_decodeString:function(i){return Ne(i)?decodeURI(i):i},getScrollable:function(){return this._scrollable},updateDimensions:function(){var i=new v,e=this.getScrollable();return e?e.update().done(()=>{i.resolveWith(this)}):i.resolveWith(this),i.promise()},selectItem:function(i){return this._updateItemSelection(!0,i)},unselectItem:function(i){return this._updateItemSelection(!1,i)},expandItem:function(i){return this._toggleExpandedState(i,!0)},collapseItem:function(i){return this._toggleExpandedState(i,!1)},getNodes:function(){return this._dataAdapter.getTreeNodes()},getSelectedNodes:function(){return this.getSelectedNodeKeys().map(i=>{var e=this._dataAdapter.getNodeByKey(i);return this._dataAdapter.getPublicNode(e)})},getSelectedNodeKeys:function(){return this._dataAdapter.getSelectedNodesKeys()},selectAll:function(){this._selectAllEnabled()?this._$selectAllItem.dxCheckBox("instance").option("value",!0):this._toggleSelectAll({value:!0})},unselectAll:function(){this._selectAllEnabled()?this._$selectAllItem.dxCheckBox("instance").option("value",!1):this._toggleSelectAll({value:!1})},_allItemsExpandedHandler:function(){this._skipContentReadyAndItemExpanded=!1,this._fireContentReadyAction()},expandAll:function(){var i=this._dataAdapter.getData(),e=[];this._skipContentReadyAndItemExpanded=!0,i.forEach(t=>e.push(this._toggleExpandedState(t.internalFields.key,!0))),Promise.allSettled(e).then(()=>{var t;return(t=this._allItemsExpanded)===null||t===void 0?void 0:t.call(this)})},collapseAll:function(){h(this._dataAdapter.getExpandedNodesKeys(),(function(i,e){this._toggleExpandedState(e,!1)}).bind(this))},scrollToItem:function(i){var e=this._getNode(i);if(!e)return new v().reject().promise();for(var t=[],n=e.internalFields.publicNode.parent;n!=null;)n.expanded||t.push(n.key),n=n.parent;var s=new v;return this._expandNodes(t.reverse()).always(()=>{var a=this._getNodeElement(e);a&&a.length?(this.scrollToElementTopLeft(a.get(0)),s.resolve()):s.reject()}),s.promise()},scrollToElementTopLeft:function(i){var e=this.getScrollable(),{scrollDirection:t,rtlEnabled:n}=this.option(),s={top:0,left:0},a=Bt(Ft,i);if(t!==Lt){var r=o(e.container()).get(0);s.left=n?a.left+i.offsetWidth-r.clientWidth:a.left}t!==Ht&&(s.top=a.top),e.scrollTo(s)},_expandNodes:function(i){if(!i||i.length===0)return new v().resolve().promise();var e=new v,t=i.map(n=>this.expandItem(n));return Ae.apply(o,t).done(()=>e.resolve()).fail(()=>e.reject()),e.promise()},_dispose:function(){this.callBase(),clearTimeout(this._setFocusedItemTimeout),this._allItemsExpandedHandler=null}});ie.setEditorClass(qe);var st="dx-treeview",Ti="".concat(st,"-node-container"),at=xi.inherit(ie).inherit({_addWidgetPrefix:function(i){return"".concat(st,"-").concat(i)},_optionChanged:function(i){switch(i.name){case"searchValue":this._showCheckboxes()&&this._isRecursiveSelection()&&this._removeSelection(),this._initDataAdapter(),this._updateSearch(),this._repaintContainer(),this.option("focusedElement",null);break;case"searchExpr":this._initDataAdapter(),this.repaint();break;case"searchMode":this.option("expandNodesRecursive")?this._updateDataAdapter():this._initDataAdapter(),this.repaint();break;default:this.callBase(i)}},_updateDataAdapter:function(){this._setOptionWithoutOptionChange("expandNodesRecursive",!1),this._initDataAdapter(),this._setOptionWithoutOptionChange("expandNodesRecursive",!0)},_getDataAdapterOptions:function(){return u(this.callBase(),{searchValue:this.option("searchValue"),searchMode:this.option("searchMode")||"contains",searchExpr:this.option("searchExpr")})},_getNodeContainer:function(){return this.$element().find(".".concat(Ti)).first()},_updateSearch:function(){if(this._searchEditor){var i=this._getSearchEditorOptions();this._searchEditor.option(i)}},_repaintContainer:function(){var i=this._getNodeContainer(),e;i.length&&(i.empty(),e=this._dataAdapter.getRootNodes(),this._renderEmptyMessage(e),this._renderItems(i,e),this._fireContentReadyAction())},_focusTarget:function(){return this._itemContainer(this.option("searchEnabled"))},_cleanItemContainer:function(){this.$element().empty()},_itemContainer:function(i,e){var t;return(t=e)!==null&&t!==void 0||(e=this._selectAllEnabled()),e?this._getNodeContainer():this._scrollable&&i?o(this._scrollable.content()):this.callBase()},_addWidgetClass:function(){this.$element().addClass(this._widgetClass())},_clean:function(){this.callBase(),this._removeSearchBox()}});ve("dxTreeView",at);var Oi=.9,Di=(i,e)=>{var t=o(We()),{top:n}=i.offset(),s;if(It(e)){if(e<n)return n-e;s=be(t)-e+t.scrollTop()}else{var a=n-t.scrollTop(),r=be(t)-a-ut(i);s=Math.max(a,r)}return s*Oi},ki="dx-context-menu-content-delimiter",wi="dx-submenu";class he extends nt{_getDefaultOptions(){return u(super._getDefaultOptions(),{orientation:"horizontal",tabIndex:null,onHoverStart:C})}_initDataAdapter(){this._dataAdapter=this.option("_dataAdapter"),this._dataAdapter||super._initDataAdapter()}_renderContentImpl(){this._renderContextMenuOverlay(),super._renderContentImpl();var e=this._dataAdapter.getNodeByKey(this.option("_parentKey"));e&&this._renderItems(this._getChildNodes(e)),this._renderDelimiter()}_renderDelimiter(){this.$contentDelimiter=o("<div>").appendTo(this._itemContainer()).addClass(ki)}_getOverlayOptions(){return u(!0,super._getOverlayOptions(),{onPositioned:this._overlayPositionedActionHandler.bind(this),position:{precise:!0}})}_overlayPositionedActionHandler(e){this._showDelimiter(e)}_hoverEndHandler(e){super._hoverEndHandler(e),this._toggleFocusClass(!1,e.currentTarget)}_isMenuHorizontal(){return this.option("orientation")==="horizontal"}_hoverStartHandler(e){var t=this.option("onHoverStart");t(e),super._hoverStartHandler(e),this._toggleFocusClass(!0,e.currentTarget)}_drawSubmenu(e){this._actions.onShowing({rootItem:m(e),submenu:this}),super._drawSubmenu(e),this._actions.onShown({rootItem:m(e),submenu:this})}_hideSubmenu(e){this._actions.onHiding({cancel:!0,rootItem:m(e),submenu:this}),super._hideSubmenu(e),this._actions.onHidden({rootItem:m(e),submenu:this})}_showDelimiter(e){if(this.$contentDelimiter){var t=this._itemContainer().children(".".concat(wi)).eq(0),n=this.option("position").of.find(".dx-context-menu-container-border"),s={of:t,precise:!0},a=e.position,r=a.v.location,l=a.h.location,d=n.offset(),c=Math.round(d.left),N=Math.round(d.top),b=Ee(n),K=_e(n),R=Ee(t),V=_e(t);this.$contentDelimiter.css("display","block"),ct(this.$contentDelimiter,this._isMenuHorizontal()?b<R?b:R:3),Ie(this.$contentDelimiter,this._isMenuHorizontal()?3:K<V?K:V),this._isMenuHorizontal()?r>N?Math.round(l)===c?(s.offset="0 -2.5",s.at=s.my="left top"):(s.offset="0 -2.5",s.at=s.my="right top"):(Ie(this.$contentDelimiter,5),Math.round(l)===c?(s.offset="0 5",s.at=s.my="left bottom"):(s.offset="0 5",s.at=s.my="right bottom")):l>c?Math.round(r)===N?(s.offset="-2.5 0",s.at=s.my="left top"):(s.offset="-2.5 0",s.at=s.my="left bottom"):Math.round(r)===N?(s.offset="2.5 0",s.at=s.my="right top"):(s.offset="2.5 0",s.at=s.my="right bottom"),Xe.setup(this.$contentDelimiter,s)}}_getContextMenuPosition(){return this.option("position")}isOverlayVisible(){return this._overlay.option("visible")}getOverlayContent(){return this._overlay.$content()}}var M="dx-menu",Mi=M+"-vertical",He=M+"-horizontal",pe=M+"-item",Ke=M+"-items-container",ue=pe+"-expanded",J="dx-context-menu",ce=J+"-container-border",Bi="dx-context-menu-content-delimiter",Li="dx-submenu",Fi="dx-state-disabled",Re="dx-state-hover",Hi="dx-state-active",Q=M+"-adaptive-mode",Ve=M+"-hamburger-button",Ki=Q+"-overlay-wrapper",Ri="up",Vi="down",Pi="left",$i="right",X="showSubmenu",F="nextItem",T="prevItem",Ui={show:50,hide:300},Pe=["onSubmenuShowing","onSubmenuShown","onSubmenuHiding","onSubmenuHidden","onItemContextMenu","onItemClick","onSelectionChanged","onItemRendered"];class Xi extends Ce{_getDefaultOptions(){return u(super._getDefaultOptions(),{orientation:"horizontal",submenuDirection:"auto",showFirstSubmenuMode:{name:"onClick",delay:{show:50,hide:300}},hideSubmenuOnMouseLeave:!1,onSubmenuShowing:null,onSubmenuShown:null,onSubmenuHiding:null,onSubmenuHidden:null,adaptivityEnabled:!1})}_setOptionsByReference(){super._setOptionsByReference(),u(this._optionsByReference,{animation:!0,selectedItem:!0})}_itemElements(){var e=super._itemElements(),t=this._submenuItemElements();return e.add(t)}_submenuItemElements(){var e=[],t=".".concat(pe),n=this._submenus.length&&this._submenus[0];return n&&n.itemsContainer()&&(e=n.itemsContainer().find(t)),e}_focusTarget(){return this.$element()}_isMenuHorizontal(){return this.option("orientation")==="horizontal"}_moveFocus(e){var t=this._getAvailableItems(),n=this._isMenuHorizontal(),s=this._getActiveItem(!0),a,r,l,d;switch(e){case Ri:r=n?X:this._getItemsNavigationOperation(T),a=n?s:t,l=this._getKeyboardNavigationAction(r,a),d=l();break;case Vi:r=n?X:this._getItemsNavigationOperation(F),a=n?s:t,l=this._getKeyboardNavigationAction(r,a),d=l();break;case $i:r=n?this._getItemsNavigationOperation(F):X,a=n?t:s,l=this._getKeyboardNavigationAction(r,a),d=l();break;case Pi:r=n?this._getItemsNavigationOperation(T):X,a=n?t:s,l=this._getKeyboardNavigationAction(r,a),d=l();break;default:return super._moveFocus(e)}d&&d.length!==0&&this.option("focusedElement",m(d))}_getItemsNavigationOperation(e){var t=e;return this.option("rtlEnabled")&&(t=e===T?F:T),t}_getKeyboardNavigationAction(e,t){var n=C;switch(e){case X:t.hasClass(Fi)||(n=this._showSubmenu.bind(this,t));break;case F:n=this._nextItem.bind(this,t);break;case T:n=this._prevItem.bind(this,t)}return n}_clean(){super._clean(),this.option("templatesRenderAsynchronously")&&clearTimeout(this._resizeEventTimer)}_visibilityChanged(e){e&&(this._menuItemsWidth||this._updateItemsWidthCache(),this._dimensionChanged())}_isAdaptivityEnabled(){return this.option("adaptivityEnabled")&&this.option("orientation")==="horizontal"}_updateItemsWidthCache(){var e=this.$element().find("ul").first().children("li").children(".".concat(pe));this._menuItemsWidth=this._getSummaryItemsWidth(e,!0)}_dimensionChanged(){if(this._isAdaptivityEnabled()){var e=_t(this.$element());this._toggleAdaptiveMode(this._menuItemsWidth>e)}}_init(){super._init(),this._submenus=[]}_initActions(){this._actions={},h(Pe,(e,t)=>{this._actions[t]=this._createActionByOption(t)})}_initMarkup(){this._visibleSubmenu=null,this.$element().addClass(M),super._initMarkup(),this._addCustomCssClass(this.$element()),this.setAria("role","menubar")}_render(){super._render(),this._initAdaptivity()}_renderHamburgerButton(){return this._hamburger=new At(o("<div>").addClass(Ve),{icon:"menu",activeStateEnabled:!1,onClick:this._toggleTreeView.bind(this)}),this._hamburger.$element()}_toggleTreeView(e){ge(e)&&(e=!this._overlay.option("visible")),this._overlay.option("visible",e),this._toggleHamburgerActiveState(e)}_toggleHamburgerActiveState(e){this._hamburger&&this._hamburger.$element().toggleClass(Hi,e)}_toggleAdaptiveMode(e){var t=this.$element().find(".".concat(He)),n=this.$element().find(".".concat(Q));e?this._hideVisibleSubmenu():(this._treeView&&this._treeView.collapseAll(),this._overlay&&this._toggleTreeView(e)),t.toggle(!e),n.toggle(e)}_removeAdaptivity(){this._$adaptiveContainer&&(this._toggleAdaptiveMode(!1),this._$adaptiveContainer.remove(),this._$adaptiveContainer=null,this._treeView=null,this._hamburger=null,this._overlay=null)}_treeviewItemClickHandler(e){this._actions.onItemClick(e),e.node.children.length||this._toggleTreeView(!1)}_getAdaptiveOverlayOptions(){var e=this.option("rtlEnabled"),t=e?"right":"left";return{_ignoreFunctionValueDeprecation:!0,maxHeight:()=>Di(this.$element()),deferRendering:!1,shading:!1,animation:!1,hideOnParentScroll:!0,onHidden:()=>{this._toggleHamburgerActiveState(!1)},height:"auto",hideOnOutsideClick:n=>!o(n.target).closest(".".concat(Ve)).length,position:{collision:"flipfit",at:"bottom "+t,my:"top "+t,of:this._hamburger.$element()}}}_getTreeViewOptions(){var e={};return h(["rtlEnabled","width","accessKey","activeStateEnabled","animation","dataSource","disabled","displayExpr","displayExpr","focusStateEnabled","hint","hoverStateEnabled","itemsExpr","items","itemTemplate","selectedExpr","selectionMode","tabIndex","visible"],(t,n)=>{e[n]=this.option(n)}),h(["onItemContextMenu","onSelectionChanged","onItemRendered"],(t,n)=>{e[n]=s=>{this._actions[n](s)}}),u(e,{dataSource:this.getDataSource(),animationEnabled:!!this.option("animation"),onItemClick:this._treeviewItemClickHandler.bind(this),onItemExpanded:t=>{this._overlay.repaint(),this._actions.onSubmenuShown(t)},onItemCollapsed:t=>{this._overlay.repaint(),this._actions.onSubmenuHidden(t)},selectNodesRecursive:!1,selectByClick:this.option("selectByClick"),expandEvent:"click"})}_initAdaptivity(){if(this._isAdaptivityEnabled()){this._$adaptiveContainer=o("<div>").addClass(Q);var e=this._renderHamburgerButton();this._treeView=this._createComponent(o("<div>"),at,this._getTreeViewOptions()),this._overlay=this._createComponent(o("<div>"),Ue,this._getAdaptiveOverlayOptions()),this._overlay.$content().append(this._treeView.$element()).addClass(Q).addClass(this.option("cssClass")),this._overlay.$wrapper().addClass(Ki),this._$adaptiveContainer.append(e),this._$adaptiveContainer.append(this._overlay.$element()),this.$element().append(this._$adaptiveContainer),this._updateItemsWidthCache(),this._dimensionChanged()}}_getDelay(e){var t=this.option("showFirstSubmenuMode").delay;return g(t)?w(t)?t[e]:t:Ui[e]}_keyboardHandler(e){return super._keyboardHandler(e,!!this._visibleSubmenu)}_renderContainer(){var e=o("<div>");return e.appendTo(this.$element()).addClass(this._isMenuHorizontal()?He:Mi),super._renderContainer(e)}_renderSubmenuItems(e,t){var n=this._createSubmenu(e,t);return this._submenus.push(n),this._renderBorderElement(t),n}_getKeyboardListeners(){return super._getKeyboardListeners().concat(this._visibleSubmenu)}_createSubmenu(e,t){var n=o("<div>").addClass(J).appendTo(t),s=this._getChildNodes(e),a=this._createComponent(n,he,u(this._getSubmenuOptions(),{_dataAdapter:this._dataAdapter,_parentKey:e.internalFields.key,items:s,onHoverStart:this._clearTimeouts.bind(this),position:this.getSubmenuPosition(t)}));return this._attachSubmenuHandlers(t,a),a}_getSubmenuOptions(){var e=o("<div>"),t=this._isMenuHorizontal();return{itemTemplate:this.option("itemTemplate"),target:e,orientation:this.option("orientation"),selectionMode:this.option("selectionMode"),cssClass:this.option("cssClass"),selectByClick:this.option("selectByClick"),hoverStateEnabled:this.option("hoverStateEnabled"),activeStateEnabled:this.option("activeStateEnabled"),focusStateEnabled:this.option("focusStateEnabled"),animation:this.option("animation"),showSubmenuMode:this.option("showSubmenuMode"),displayExpr:this.option("displayExpr"),disabledExpr:this.option("disabledExpr"),selectedExpr:this.option("selectedExpr"),itemsExpr:this.option("itemsExpr"),onFocusedItemChanged:n=>{n.component.option("visible")&&this.option("focusedElement",n.component.option("focusedElement"))},onSelectionChanged:this._nestedItemOnSelectionChangedHandler.bind(this),onItemClick:this._nestedItemOnItemClickHandler.bind(this),onItemRendered:this._nestedItemOnItemRenderedHandler.bind(this),onLeftFirstItem:t?null:this._moveMainMenuFocus.bind(this,T),onLeftLastItem:t?null:this._moveMainMenuFocus.bind(this,F),onCloseRootSubmenu:this._moveMainMenuFocus.bind(this,t?T:null),onExpandLastSubmenu:t?this._moveMainMenuFocus.bind(this,F):null}}_getShowFirstSubmenuMode(){if(!this._isDesktopDevice())return"onClick";var e=this.option("showFirstSubmenuMode");return w(e)?e.name:e}_moveMainMenuFocus(e){var t=this._getAvailableItems(),n=t.length,s=t.filter(".".concat(ue)).eq(0),a=t.index(s);this._hideSubmenu(this._visibleSubmenu),a+=e===T?-1:1,a>=n?a=0:a<0&&(a=n-1);var r=t.eq(a);this.option("focusedElement",m(r))}_nestedItemOnSelectionChangedHandler(e){var t=e.addedItems.length&&e.addedItems[0],n=he.getInstance(e.element),s=this._actions.onSelectionChanged;s(e),t&&this._clearSelectionInSubmenus(t[0],n),this._clearRootSelection(),this._setOptionWithoutOptionChange("selectedItem",t)}_clearSelectionInSubmenus(e,t){var n=!arguments.length;h(this._submenus,(s,a)=>{var r=a._itemContainer(),l=!r.is(t&&t._itemContainer()),d=r.find(".".concat(this._selectedItemClass()));if(l&&d.length||n){d.removeClass(this._selectedItemClass());var c=this._getItemData(d);c&&(c.selected=!1),a._clearSelectedItems()}})}_clearRootSelection(){var e=this.$element().find(".".concat(Ke)).first().children().children().filter(".".concat(this._selectedItemClass()));if(e.length){var t=this._getItemData(e);t.selected=!1,e.removeClass(this._selectedItemClass())}}_nestedItemOnItemClickHandler(e){this._actions.onItemClick(e)}_nestedItemOnItemRenderedHandler(e){this._actions.onItemRendered(e)}_attachSubmenuHandlers(e,t){var n=t.getOverlayContent(),s=n.find(".".concat(Li)),a=I(mt,this.NAME+"_submenu");t.option({onShowing:this._submenuOnShowingHandler.bind(this,e,t),onShown:this._submenuOnShownHandler.bind(this,e,t),onHiding:this._submenuOnHidingHandler.bind(this,e,t),onHidden:this._submenuOnHiddenHandler.bind(this,e,t)}),h(s,(r,l)=>{_.off(l,a),_.on(l,a,null,this._submenuMouseLeaveHandler.bind(this,e))})}_submenuOnShowingHandler(e,t){var n=e.children(".".concat(ce));this._actions.onSubmenuShowing({rootItem:m(e),submenu:t}),n.show(),e.addClass(ue)}_submenuOnShownHandler(e,t){this._actions.onSubmenuShown({rootItem:m(e),submenu:t})}_submenuOnHidingHandler(e,t,n){var s=e.children(".".concat(ce)),a=n;a.rootItem=m(e),a.submenu=t,this._actions.onSubmenuHiding(a),n=a,n.cancel||(this._visibleSubmenu===t&&(this._visibleSubmenu=null),s.hide(),e.removeClass(ue))}_submenuOnHiddenHandler(e,t){this._actions.onSubmenuHidden({rootItem:m(e),submenu:t})}_submenuMouseLeaveHandler(e,t){var n=o(t.relatedTarget).parents(".".concat(J))[0],s=this._getSubmenuByRootElement(e).getOverlayContent()[0];this.option("hideSubmenuOnMouseLeave")&&n!==s&&(this._clearTimeouts(),setTimeout(this._hideSubmenuAfterTimeout.bind(this),this._getDelay("hide")))}_hideSubmenuAfterTimeout(){if(this._visibleSubmenu){var e=o(this._visibleSubmenu.$element().context).hasClass(Re),t=this._visibleSubmenu.getOverlayContent().find(".".concat(Re)).length,n=this._visibleSubmenu.getOverlayContent().get(0).querySelector(":hover");!n&&!t&&!e&&this._visibleSubmenu.hide()}}_getSubmenuByRootElement(e){if(!e)return!1;var t=e.children(".".concat(J));return t.length&&he.getInstance(t)}getSubmenuPosition(e){var t=this._isMenuHorizontal(),n=this.option("submenuDirection").toLowerCase(),s=this.option("rtlEnabled"),a={collision:"flip",of:e,precise:!0};switch(n){case"leftortop":a.at="left top",a.my=t?"left bottom":"right top";break;case"rightorbottom":a.at=t?"left bottom":"right top",a.my="left top";break;default:t?(a.at=s?"right bottom":"left bottom",a.my=s?"right top":"left top"):(a.at=s?"left top":"right top",a.my=s?"right top":"left top")}return a}_renderBorderElement(e){o("<div>").appendTo(e).addClass(ce).hide()}_itemPointerDownHandler(e){var t=o(e.target),n=t.closest(this._itemElements());if(n.hasClass("dx-menu-item-has-submenu")){this.option("focusedElement",null);return}super._itemPointerDownHandler(e)}_hoverStartHandler(e){var t=I(Ge.move,this.NAME),n=this._getItemElementByEventArgs(e),s=this._dataAdapter.getNodeByItem(this._getItemData(n)),a=g(e.buttons)&&e.buttons===1||!g(e.buttons)&&e.which===1;if(!this._isItemDisabled(n)){if(_.off(n,t),!this._hasChildren(s)){this._showSubmenuTimer=setTimeout(this._hideSubmenuAfterTimeout.bind(this),this._getDelay("hide"));return}if(this._getShowFirstSubmenuMode()==="onHover"&&!a){var r=this._getSubmenuByElement(n);this._clearTimeouts(),r.isOverlayVisible()||(_.on(n,t,this._itemMouseMoveHandler.bind(this)),this._showSubmenuTimer=this._getDelay("hide"))}}}_hoverEndHandler(e){var t=this._getItemElementByEventArgs(e),n=o(e.relatedTarget);super._hoverEndHandler(e),this._clearTimeouts(),!this._isItemDisabled(t)&&(n.hasClass(Bi)||this.option("hideSubmenuOnMouseLeave")&&!n.hasClass(Ke)&&(this._hideSubmenuTimer=setTimeout(()=>{this._hideSubmenuAfterTimeout()},this._getDelay("hide"))))}_hideVisibleSubmenu(){return this._visibleSubmenu?(this._hideSubmenu(this._visibleSubmenu),!0):!1}_showSubmenu(e){var t=this._getSubmenuByElement(e);this._visibleSubmenu!==t&&this._hideVisibleSubmenu(),t&&(this._clearTimeouts(),this.focus(),t.show(),this.option("focusedElement",t.option("focusedElement"))),this._visibleSubmenu=t,this._hoveredRootItem=e}_hideSubmenu(e){e&&e.hide(),this._visibleSubmenu===e&&(this._visibleSubmenu=null),this._hoveredRootItem=null}_itemMouseMoveHandler(e){if(!(e.pointers&&e.pointers.length)){var t=o(e.currentTarget);g(this._showSubmenuTimer)&&(this._clearTimeouts(),this._showSubmenuTimer=setTimeout(()=>{var n=this._getSubmenuByElement(t);n&&!n.isOverlayVisible()&&this._showSubmenu(t)},this._getDelay("show")))}}_clearTimeouts(){clearTimeout(this._hideSubmenuTimer),clearTimeout(this._showSubmenuTimer)}_getSubmenuByElement(e,t){var n=this._getSubmenuByRootElement(e);if(n)return n;t=t||this._getItemData(e);var s=this._dataAdapter.getNodeByItem(t);return this._hasChildren(s)&&this._renderSubmenuItems(s,e)}_updateSubmenuVisibilityOnClick(e){var t=e.args.length&&e.args[0];if(!(!t||this._disabledGetter(t.itemData))){var n=o(t.itemElement),s=this._getSubmenuByElement(n,t.itemData);if(this._updateSelectedItemOnClick(e),this._visibleSubmenu)if(this._visibleSubmenu===s){this.option("showFirstSubmenuMode")==="onClick"&&this._hideSubmenu(this._visibleSubmenu);return}else this._hideSubmenu(this._visibleSubmenu);if(s&&!s.isOverlayVisible()){this._showSubmenu(n);return}}}_optionChanged(e){if(Pe.indexOf(e.name)>=0){this._initActions();return}switch(e.name){case"orientation":case"submenuDirection":this._invalidate();break;case"showFirstSubmenuMode":case"hideSubmenuOnMouseLeave":break;case"showSubmenuMode":this._changeSubmenusOption(e.name,e.value);break;case"adaptivityEnabled":e.value?this._initAdaptivity():this._removeAdaptivity();break;case"width":this._isAdaptivityEnabled()&&(this._treeView.option(e.name,e.value),this._overlay.option(e.name,e.value)),super._optionChanged(e),this._dimensionChanged();break;case"animation":this._isAdaptivityEnabled()&&this._treeView.option("animationEnabled",!!e.value),super._optionChanged(e);break;default:this._isAdaptivityEnabled()&&(e.name===e.fullName||e.name==="items")&&this._treeView.option(e.fullName,e.value),super._optionChanged(e)}}_changeSubmenusOption(e,t){h(this._submenus,(n,s)=>{s.option(e,t)})}selectItem(e){this._hideSubmenu(this._visibleSubmenu),super.selectItem(e)}unselectItem(e){this._hideSubmenu(this._visibleSubmenu),super.selectItem(e)}}ve("dxMenu",Xi);export{nt as C,Se as D,Xi as M,at as T,Di as g};
