import{_ as R}from"./section-title.vue.7a626818.js";import B from"./Icon.cc46943a.js";import{_ as A}from"./img-wrapper.764f03cb.js";import{b as S,d as q,m as N,r as v,o as _,c as h,g as e,h as w,f as c,y as x,e as l,u as T,a as U,w as f,t as $,i as k,A as z,j as L,V as Q,E as G}from"./entry.f47474d7.js";import{u as H}from"./useMutation.0193d648.js";import{u as E}from"./toast.cc97a672.js";import{f as I,D,a as C,c as P,b as K,d as O,e as W}from"./form.73bc073f.js";import{_ as J}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.b8fe2cb5.js";import"./notify.6d2dad03.js";import"./index.94f86987.js";import"./_commonjsHelpers.23102255.js";import"./ui.form.bf59509c.js";import"./text_box.08b8e7e6.js";import"./resize_observer.3c2fa9a2.js";import"./ui.popup.81669a77.js";import"./ui.collection_widget.edit.95cdfece.js";import"./load_panel.0862d4ae.js";import"./check_box.j.64bc2370.js";import"./ui.list.edit.decorator.selection.f35f8c9c.js";async function X(t){const r=S(),{data:a}=await r.client.post("profile/photo/update",t);return a}var b=(t=>(t.alt="components.profile_photo.alt",t.alt_preview="components.profile_photo.alt_preview",t.error_fatal="components.profile_photo.error_fatal",t.profile_photo_updated_successfully="components.profile_photo.profile_photo_updated_successfully",t))(b||{});const Y={class:"relative"},Z=["disabled"],M=q({__name:"profile-photo",props:{avatarUrl:{},disabled:{type:Boolean}},setup(t){const r=t,a=N(),p=E(),u=v(null),{mutate:m}=H({mutationFn:s=>X(s)});function g(s){const[d]=s.currentTarget.files??[];if(!d){u.value=null;return}u.value=URL.createObjectURL(d);const n=new FormData;n.append("photo",d),m(n,{onSuccess(){a.invalidateQueries({queryKey:["profile"]}),p.show(b.profile_photo_updated_successfully)},onError:p.error})}return(s,d)=>{const n=A,o=B;return _(),h("div",Y,[e(u)?(_(),w(n,{key:0,src:e(u),alt:s.$t(e(b).alt_preview),class:"rounded-full w-52 h-52 object-cover lg:w-44 lg:h-44"},null,8,["src","alt"])):(_(),w(n,{key:1,src:r.avatarUrl,alt:s.$t(e(b).alt),class:"rounded-full w-52 h-52 object-cover lg:w-44 lg:h-44"},null,8,["src","alt"])),c("div",{class:x(`
      bg-black absolute w-min bottom-3 right-3 rounded-full p-2 transition-all
      ${r.disabled?"bg-opacity-20":"bg-opacity-70 cursor-pointer hover:bg-opacity-50"}
      `)},[c("label",{for:"fileInput",class:x(r.disabled?"cursor-default":"cursor-pointer")},[l(o,{name:"iconamoon:camera-image-duotone",size:"24",class:"text-font-light"})],2),c("input",{id:"fileInput",type:"file",style:{display:"none"},accept:"image/*",disabled:r.disabled,onChange:g},null,40,Z)],2)])}}});var i=(t=>(t.title="pages.settings.profile.title",t.info_user_ad="pages.settings.profile.info_user_ad",t.subtitle="pages.settings.profile.subtitle",t.field_name="pages.settings.profile.field_name",t.field_email="pages.settings.profile.field_email",t.validation_invalid_email="pages.settings.profile.validation_invalid_email",t.validation_required_field="pages.settings.profile.validation_required_field",t.error_user_already_exists="pages.settings.profile.error_user_already_exists",t.action_update="pages.settings.profile.action_update",t.profile_updated_successfully="pages.settings.profile.profile_updated_successfully",t))(i||{});const ee={key:0,class:"p-2 bg-error-light mb-2 rounded-md flex justify-between"},te={class:"flex-1 bg-background-content flex justify-center border border-divider rounded-md shadow-lg"},oe={key:0,class:"grid p-4 w-full max-w-5xl gap-8 items-center lg:flex"},ae={class:"place-self-center"},le=q({__name:"profile",setup(t){var d,n;const{t:r}=T();U({title:r(i.title)});const a=S(),p=E(),u=v(!0),m=v({name:(d=a.profile)==null?void 0:d.name,email:(n=a.profile)==null?void 0:n.email});function g(){u.value=!1}async function s(){try{await a.updateProfile(m.value),p.show(i.profile_updated_successfully)}catch(o){o instanceof Q?o.errorsByField.email?p.show(i.error_user_already_exists,"error"):p.show(o.messageId,"error"):o instanceof G&&p.show(o.messageId,"error")}}return(o,ie)=>{var y;const j=R,V=B,F=M;return _(),h("div",null,[l(j,null,{default:f(()=>[L($(o.$t(e(i).title)),1)]),_:1}),(y=e(a).profile)!=null&&y.oath_sso&&e(u)?(_(),h("div",ee,[c("span",null,$(o.$t(e(i).info_user_ad)),1),l(V,{size:"25",name:"material-symbols:close-small-outline",class:"cursor-pointer",onClick:g})])):k("",!0),c("div",te,[e(a).profile?(_(),h("div",oe,[c("div",ae,[l(F,{"avatar-url":e(a).profile.photo_url,disabled:e(a).profile.oath_sso},null,8,["avatar-url","disabled"])]),c("form",{class:"flex-1",onSubmit:z(s,["prevent"])},[l(e(W),{"form-data":e(m),"label-location":"top"},{default:f(()=>[l(e(I),{caption:o.$t(e(i).subtitle),"col-count":1},{default:f(()=>[l(e(D),{"data-field":"name",disabled:e(a).profile.oath_sso},{default:f(()=>[l(e(C),{text:o.$t(e(i).field_name)},null,8,["text"]),l(e(P),{message:o.$t(e(i).validation_required_field)},null,8,["message"])]),_:1},8,["disabled"]),l(e(D),{"data-field":"email",disabled:e(a).profile.oath_sso},{default:f(()=>[l(e(C),{text:o.$t(e(i).field_email)},null,8,["text"]),l(e(K),{message:o.$t(e(i).validation_invalid_email)},null,8,["message"]),l(e(P),{message:o.$t(e(i).validation_required_field)},null,8,["message"])]),_:1},8,["disabled"])]),_:1},8,["caption"]),l(e(O),{"button-options":{text:o.$t(e(i).action_update),useSubmitBehavior:!0},disabled:e(a).profile.oath_sso},null,8,["button-options","disabled"])]),_:1},8,["form-data"])],32)])):k("",!0)])])}}});const Ce=J(le,[["__scopeId","data-v-bb53a0ef"]]);export{Ce as default};
