import{_ as v}from"./section-title.vue.a6fe2dde.js";import{d as D,u as R,a as x,H as C,x as k,b as E,o as F,c as L,e as c,w as f,g as s,j as P,t as S}from"./entry.d8c3daa0.js";import{C as U,D as j,a as I}from"./file-manager.8cc5f50e.js";import"./_commonjsHelpers.23102255.js";import"./index.ab648286.js";import"./notify.edf537cb.js";import"./ui.form.675e7539.js";import"./text_box.67135b71.js";import"./resize_observer.57c96ed3.js";import"./ui.popup.28c204f7.js";import"./ui.collection_widget.edit.f359a828.js";import"./load_panel.57c43a65.js";import"./check_box.j.46b9e12f.js";import"./ui.list.edit.decorator.selection.2d64423b.js";import"./ui.menu.8ddfdf72.js";import"./row_dragging.d0454e7a.js";import"./ui.toolbar.89924961.js";import"./m_sortable.23c59dc8.js";var a=(i=>(i.title="pages.services.file_manager.title",i.error_fatal="pages.services.file_manager.error_fatal",i))(a||{});const Z=D({__name:"index",setup(i){const{t:n}=R();x({title:n(a.title)});const d=C(),h=k(),p=E(),_=h.query.path??"";async function m(e){try{const t=e.path,r=t.split("/").pop(),o=await p.client.get("/files/download",{params:{path:t}});return{name:r,url:o.data}}catch{throw new Error(n(a.error_fatal))}}const w=new U({async getItems(e){try{const t=await p.client.get("/files",{params:{path:e.path}}),r=[];for(const o of t.data.folders)r.push({name:o,isDirectory:!0});for(const o of t.data.files)r.push({name:o.split("/").pop(),isDirectory:!1});return r}catch{throw new Error(n(a.error_fatal))}},async downloadItems(e){if(e.length!==1)throw new Error(n(a.error_fatal));const t=await m(e[0]);try{const o=await(await fetch(t.url)).blob(),u=URL.createObjectURL(o),l=document.createElement("a");l.download=t.name,l.target="_blank",l.href=u,l.click(),URL.revokeObjectURL(u)}catch{throw new Error(n(a.error_fatal))}}});function y(e){d.push({query:{path:e.directory.path}})}async function g(e){const t=await m(e.file);open(t.url,"_blank")}function b(e){return e.slice(0,2)}return(e,t)=>{const r=v;return F(),L("div",null,[c(r,null,{default:f(()=>[P(S(e.$t(s(a).title)),1)]),_:1}),c(s(I),{"selection-mode":"single","current-path":s(_),"customize-detail-columns":b,"file-system-provider":s(w),onCurrentDirectoryChanged:y,onSelectedFileOpened:g},{default:f(()=>[c(s(j),{download:!0})]),_:1},8,["current-path","file-system-provider"])])}}});export{Z as default};
