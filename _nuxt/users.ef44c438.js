import{_ as S}from"./section-title.vue.7a626818.js";import{d as V,u as A,a as T,b as j,r as m,q as E,o as v,c as H,e as i,w as d,f as L,g as e,V as $,E as b,j as O,t as P,h as D,i as k}from"./entry.f47474d7.js";import{D as G,e as K,f as z,g as J,h as Q,a as p,i as g,j as f,k as W,b as X,l as Y,m as Z,c as I}from"./data-grid.49f07671.js";import{C as M}from"./ui.collection_widget.edit.95cdfece.js";import{u as ee}from"./roles-store.739f5c1f.js";import{u as ae}from"./toast.cc97a672.js";import{_ as te}from"./_plugin-vue_export-helper.c27b6911.js";import"./_commonjsHelpers.23102255.js";import"./row_dragging.56a54afd.js";import"./index.94f86987.js";import"./ui.form.bf59509c.js";import"./text_box.08b8e7e6.js";import"./resize_observer.3c2fa9a2.js";import"./ui.popup.81669a77.js";import"./load_panel.0862d4ae.js";import"./check_box.j.64bc2370.js";import"./ui.list.edit.decorator.selection.f35f8c9c.js";import"./ui.menu.f201d4e6.js";import"./ui.toolbar.1b55a2cc.js";import"./m_sortable.242c124b.js";import"./notify.6d2dad03.js";var r=(t=>(t.title="pages.admin.users.title",t.field_name="pages.admin.users.field_name",t.field_email="pages.admin.users.field_email",t.field_role="pages.admin.users.field_role",t.field_ad="pages.admin.users.field_ad",t.field_password="pages.admin.users.field_password",t.field_confirm_password="pages.admin.users.field_confirm_password",t.action_add_user="pages.admin.users.action_add_user",t.action_update="pages.admin.users.action_update",t.action_delete="pages.admin.users.action_delete",t.validation_required_field="pages.admin.users.validation_required_field",t.validation_invalid_email="pages.admin.users.validation_invalid_email",t.validation_fix_following_fields="pages.admin.users.validation_fix_following_fields",t.validation_mismatched_passwords="pages.admin.users.validation_mismatched_passwords",t.validation_password_length="pages.admin.users.validation_password_length",t.toast_user_attached="pages.admin.users.toast_user_attached",t.toast_user_created="pages.admin.users.toast_user_created",t.toast_user_removed="pages.admin.users.toast_user_removed",t.toast_user_updated="pages.admin.users.toast_user_updated",t.error_user_already_exists="pages.admin.users.error_user_already_exists",t.error_new_user_already_exists="pages.admin.users.error_new_user_already_exists",t))(r||{});const se={class:"shadow-lg"},ie=V({__name:"users",setup(t){const{t:_}=A();T({title:_(r.title)});const C=ee(),n=j(),c=ae(),h=m(1/0),R=E(()=>(n.activeAccount,new M({key:"id",async load(){var s;const a=await n.client.get(`accounts/${(s=n.activeAccount)==null?void 0:s.id}`);return h.value=a.data.users.length,a.data.users},async insert(a){try{delete a.confirm_password,l.value?(await n.client.put(`users/${a.email}/update?byEmail=true`,{role:a.role}),c.show(r.toast_user_attached)):(await n.client.post("users/create",a),c.show(r.toast_user_created))}catch(s){throw s instanceof $?s.errorsByField.email?(l.value=!0,delete a.name,delete a.password,new Error(_(r.error_new_user_already_exists))):new Error(_(s.messageId)):s instanceof b?new Error(_(s.messageId)):s}},async update(a,s){if(delete s.confirm_password,s.password===""&&delete s.password,Object.keys(s).length!==0)try{await n.client.put(`users/${a}/update`,s),c.show(r.toast_user_updated)}catch(o){throw o instanceof $?o.errorsByField.email?new Error(_(r.error_user_already_exists)):o:o instanceof b?new Error(_(o.messageId)):o}},async remove(a){await n.client.post(`users/${a}/accounts/detach`),c.show(r.toast_user_removed)}}))),q=E(()=>{var s,o;const a=parseInt(((o=(s=n.activeAccount)==null?void 0:s.details)==null?void 0:o.max_users)??"");return isNaN(a)||a>h.value}),w=m(!1),l=m(!1),u=m(!1);function N(a){w.value=!0,a.data.role="viewer"}function U(a){(l.value||a.data.oath_sso)&&(u.value=!0)}function y(){w.value=!1,l.value=!1,u.value=!1}const x=m(""),B={mode:"password",onKeyUp(a){var o;const s=(o=a.event)==null?void 0:o.currentTarget;x.value=s.value}};function F(){return x.value}return(a,s)=>{const o=S;return v(),H("div",null,[i(o,null,{default:d(()=>[O(P(a.$t(e(r).title)),1)]),_:1}),L("div",se,[i(e(I),{"data-source":e(R),"show-borders":!0,"hover-state-enabled":!0,onInitNewRow:N,onSaved:y,onEditCanceled:y,onEditingStart:U},{default:d(()=>[i(e(G),{visible:!0}),i(e(K),{visible:!0}),i(e(z),{mode:"popup","allow-adding":e(q),"allow-updating":!0,"allow-deleting":!0,"use-icons":!0},{default:d(()=>[i(e(J),{"label-location":"top","col-count":1}),i(e(Q),{title:"Add user","max-width":"70ch","max-height":"60ch","hide-on-outside-click":!0})]),_:1},8,["allow-adding"]),i(e(p),{"data-field":"name",caption:a.$t(e(r).field_name),"allow-editing":!e(u)},{default:d(()=>[i(e(g),{visible:!e(l)},null,8,["visible"]),e(l)?k("",!0):(v(),D(e(f),{key:0,message:a.$t(e(r).validation_required_field)},null,8,["message"]))]),_:1},8,["caption","allow-editing"]),i(e(p),{"data-field":"email",caption:a.$t(e(r).field_email),"allow-editing":!e(u)},{default:d(()=>[i(e(f),{message:a.$t(e(r).validation_required_field)},null,8,["message"]),i(e(W),{message:a.$t(e(r).validation_invalid_email)},null,8,["message"])]),_:1},8,["caption","allow-editing"]),i(e(p),{"data-field":"role",caption:a.$t(e(r).field_role),"allow-editing":!e(u)},{default:d(()=>[i(e(X),{"data-source":e(C).lookup,"value-expr":"id","display-expr":"caption"},null,8,["data-source"]),i(e(f),{message:a.$t(e(r).validation_required_field)},null,8,["message"])]),_:1},8,["caption","allow-editing"]),i(e(p),{"data-field":"password",caption:a.$t(e(r).field_password),visible:!1,"allow-editing":!e(u)},{default:d(()=>[e(w)&&!e(l)?(v(),D(e(f),{key:0,message:a.$t(e(r).validation_required_field)},null,8,["message"])):k("",!0),i(e(g),{visible:!e(l),"editor-options":B},null,8,["visible"]),i(e(Y),{min:8,"ignore-empty-value":!0,message:a.$t(e(r).validation_password_length)},null,8,["message"])]),_:1},8,["caption","allow-editing"]),i(e(p),{"data-field":"confirm_password",caption:a.$t(e(r).field_confirm_password),visible:!1,"allow-editing":!e(u)},{default:d(()=>[i(e(Z),{message:a.$t(e(r).validation_mismatched_passwords),"comparison-target":F},null,8,["message"]),i(e(g),{visible:!e(l),"editor-options":{mode:"password"}},null,8,["visible"])]),_:1},8,["caption","allow-editing"])]),_:1},8,["data-source"])])])}}});const ke=te(ie,[["__scopeId","data-v-89915f5a"]]);export{ke as default};
