import{_ as W}from"./section-title.vue.a6fe2dde.js";import X from"./Icon.88a3f6c0.js";import{D as B,b as Y}from"./popup.8627a468.js";import{_ as ee,D as E}from"./list.ccedf9db.js";import{A as te}from"./ui.collection_widget.edit.f359a828.js";import{d as T,m as se,r as $,q as oe,L,o,c as i,e as h,w as S,f as e,g as k,j as K,t as u,F as v,B as g,p as M,l as V,k as ie,K as le}from"./entry.d8c3daa0.js";import{u as N}from"./useQuery.67bd27fb.js";import{u as Q}from"./useMutation.0937a1e9.js";import{l as ae,a as re,d as ne,b as de}from"./simc-account-queries.762d23fb.js";import{u as ce}from"./toast.d4c6a9e4.js";import{_ as z}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.b8fe2cb5.js";import"./_commonjsHelpers.23102255.js";import"./resize_observer.57c96ed3.js";import"./index.ab648286.js";import"./ui.toolbar.89924961.js";import"./ui.popup.28c204f7.js";import"./load_panel.57c43a65.js";import"./ui.list.edit.decorator.selection.2d64423b.js";import"./check_box.j.46b9e12f.js";import"./text_box.67135b71.js";import"./m_sortable.23c59dc8.js";import"./notify.edf537cb.js";const O=p=>(M("data-v-4e76f114"),p=p(),V(),p),ue={class:"grid"},pe={class:"grid grid-cols-[1fr,3fr] gap-2"},me={class:"flex flex-col"},_e=O(()=>e("div",{class:"bg-primary text-font-light p-2 text-center font-semibold rounded-t-lg"}," Perfis ",-1)),fe={id:"scroll",class:"flex flex-col gap-1 p-2 max-h-[58vh] border border-divider rounded-b-lg overflow-auto"},he={class:"flex flex-col"},ve=O(()=>e("div",{class:"bg-primary text-font-light p-2 text-center font-semibold rounded-t-lg"}," Permissões de acesso ",-1)),xe={id:"scroll",class:"flex flex-col gap-1 p-2 max-h-[58vh] border border-divider rounded-b-lg overflow-auto"},ge={class:"flex gap-1"},ye={class:"flex gap-1"},be={class:"flex justify-end items-end gap-2 mt-2"},we=T({__name:"modal-add-profile-user",props:{user:{}},setup(p){const c=p,_=se(),b=ce(),m=$(!1),{data:C}=N({queryKey:["simc accounts"],queryFn:ae}),{mutate:I}=Q({mutationKey:["attach simc users",c.user.id],mutationFn:l=>re(c.user.id,l)}),{mutate:F}=Q({mutationKey:["attach simc users",c.user.id],mutationFn:l=>ne(c.user.id,l)}),d=oe(()=>{var l;return new te({key:"id",data:(l=C.value)==null?void 0:l.map(n=>({id:n.id,text:n.name}))})}),f=$([]),D=$([]),U=$([]);function R(){f.value=c.user.profiles.map(l=>l.id)}function Z(){D.value=[{title:"Dados",uls:[]}]}function G(){var r;const l=(r=C.value)==null?void 0:r.filter(t=>{var s;return(s=f.value)==null?void 0:s.includes(t.id)}),n=l==null?void 0:l.flatMap(t=>t.sections.map(s=>({id:s.id,title:s.name,contents:s.contents.map(y=>({id:y.id,title:y.title,profiles:[{id:t.id,name:t.name}]}))}))),x=n==null?void 0:n.reduce((t,s)=>{const y=t.find(w=>w.id===s.id);return y?y.contents.push(...s.contents):t.push({...s,contents:[...s.contents]}),t},[]),a=x==null?void 0:x.map(t=>{const s={};return t.contents.forEach(y=>{const{id:w,profiles:j,...J}=y;s[w]?s[w].profiles.push(...j):s[w]={id:w,profiles:[...j],...J}}),t.contents=Object.values(s),t});U.value=[{title:"Seções",sections:a}]}function H(){var x,a;const l=(x=f.value)==null?void 0:x.filter(r=>{var t;return!((t=c.user)!=null&&t.profiles.map(s=>s.id).includes(r))}),n=(a=c.user)==null?void 0:a.profiles.map(r=>r.id).filter(r=>!f.value.includes(r));l.length>0&&I({profiles:l},{onSuccess:()=>{_.invalidateQueries({queryKey:["simc users"]}),_.invalidateQueries({queryKey:["simc user",c.user.id]}),q(),b.show("attach success")},onError:b.error}),n.length>0&&F({profiles:n},{onSuccess:()=>{_.invalidateQueries({queryKey:["simc users"]}),_.invalidateQueries({queryKey:["simc user",c.user.id]}),q(),b.show("detach success")},onError:b.error})}function P(){m.value=!m.value,m.value===!1&&q()}function q(){m.value=!1}return L(()=>{d.value&&R()}),L(()=>{d.value&&(Z(),G())}),(l,n)=>{const x=X;return o(),i(v,null,[h(x,{size:"25",name:"mdi:badge-account-horizontal-outline",class:"cursor-pointer",onClick:P}),h(k(Y),{visible:m.value,"onUpdate:visible":n[1]||(n[1]=a=>m.value=a),"content-template":"popup-content","show-title":!0,"drag-enabled":!1,"hide-on-outside-click":P,"show-close-button":!1,title:"Atribuir perfis de usuário"},{"popup-content":S(()=>[e("div",ue,[e("div",pe,[e("div",me,[_e,e("div",fe,[h(k(ee),{"selected-item-keys":f.value,"onUpdate:selectedItemKeys":n[0]||(n[0]=a=>f.value=a),"data-source":d.value,"show-selection-controls":!0,"selection-mode":"all","select-all-mode":"page","select-by-click":!0},null,8,["selected-item-keys","data-source"])])]),e("div",he,[ve,e("div",xe,[h(k(E),{"data-source":D.value,collapsible:!0,multiple:!0,"animation-duration":450,"item-template":"item","item-title-template":"title"},{title:S(a=>[K(u(a.title),1)]),item:S(({data:a})=>[(o(!0),i(v,null,g(a.uls,r=>(o(),i("div",{key:r.id,class:"grid gap-1"},[e("span",null,u(r.title),1),(o(!0),i(v,null,g(r.subuls,t=>(o(),i("div",{key:t.id,class:"pl-4 flex justify-between"},[e("span",null,u(t.title),1),e("div",ge,[(o(!0),i(v,null,g(t.profiles,s=>(o(),i("span",{key:s.id,class:"bg-highlight w-min whitespace-nowrap px-1 rounded-md"},u(s.name),1))),128))])]))),128))]))),128))]),_:1},8,["data-source"]),h(k(E),{"data-source":U.value,collapsible:!0,multiple:!0,"animation-duration":450,"item-template":"item","item-title-template":"title"},{title:S(({data:a})=>[K(u(a.title),1)]),item:S(({data:a})=>[(o(!0),i(v,null,g(a.sections,r=>(o(),i("div",{key:r.id,class:"grid gap-1"},[e("span",null,u(r.title),1),(o(!0),i(v,null,g(r.contents,t=>(o(),i("div",{key:t.id,class:"pl-4 flex justify-between"},[e("span",null,u(t.title),1),e("div",ye,[(o(!0),i(v,null,g(t.profiles,s=>(o(),i("span",{key:s.id,class:"bg-highlight w-min whitespace-nowrap px-1 rounded-md"},u(s.name),1))),128))])]))),128))]))),128))]),_:1},8,["data-source"])])])]),e("div",be,[h(k(B),{text:"Cancelar",name:"cancel","styling-mode":"outlined",onClick:P}),h(k(B),{text:"Salvar",name:"save",onClick:H})])])]),_:1},8,["visible"])],64)}}});const ke=z(we,[["__scopeId","data-v-4e76f114"]]),A=p=>(M("data-v-f2d05277"),p=p(),V(),p),Se={class:"grid bg-background-content p-2 gap-2"},Ce={class:"relative overflow-x-auto grid gap-2"},$e={class:"flex justify-between"},Ie={class:"flex gap-2"},Fe=A(()=>e("label",{for:"table-search",class:"sr-only"},"Search",-1)),Pe={class:"relative"},qe=A(()=>e("div",{class:"absolute text-font inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none"},[e("svg",{class:"w-4 h-4","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20"},[e("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"})])],-1)),Ke={class:"w-full text-sm text-left rtl:text-right text-font"},Ae=A(()=>e("thead",{class:"text-xs uppercase bg-primary text-font-light"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 rounded-tl-lg"},"ID"),e("th",{scope:"col",class:"px-6 py-3"},"Name"),e("th",{scope:"col",class:"px-6 py-3"},"Email"),e("th",{scope:"col",class:"px-6 py-3"},"Profile"),e("th",{scope:"col",class:"px-6 py-3 w-0 rounded-tr-lg"})])],-1)),De={class:"px-6 py-2"},Ue={class:"px-6 py-2 whitespace-nowrap"},je={class:"px-6 py-2"},Be={class:"px-6 py-2 flex gap-1"},Ee={key:0,class:"bg-highlight w-min whitespace-nowrap px-1 rounded-md"},Le={key:1},Qe={class:"px-6 py-2 opacity-0 group-hover:opacity-100 transition-opacity"},Te=T({__name:"users",setup(p){const{data:c}=N({queryKey:["simc users"],queryFn:de}),_=$("");function b(){return c.value?c.value.filter(m=>m.name.toLowerCase().includes(_.value.toLowerCase())||m.email.toLowerCase().includes(_.value.toLowerCase())):[]}return(m,C)=>{const I=W,F=ke;return o(),i("div",Se,[e("div",Ce,[e("div",$e,[h(I,null,{default:S(()=>[K("Users")]),_:1}),e("div",Ie,[e("div",null,[Fe,e("div",Pe,[qe,ie(e("input",{id:"table-search","onUpdate:modelValue":C[0]||(C[0]=d=>_.value=d),type:"text",class:"block ps-10 text-sm h-10 text-font border border-divider rounded-lg w-80 bg-background outline-none",placeholder:"Search users"},null,512),[[le,_.value]])])])])]),e("table",Ke,[Ae,e("tbody",null,[(o(!0),i(v,null,g(b(),d=>(o(),i("tr",{key:d.id,class:"border-b border-primary hover:bg-divider group"},[e("td",De,u(d.id),1),e("td",Ue,u(d.name),1),e("td",je,u(d.email),1),e("td",Be,[(o(!0),i(v,null,g(d.profiles,f=>(o(),i("div",{key:f.id},[d.profiles.length>0?(o(),i("span",Ee,u(f.name),1)):(o(),i("span",Le,"-"))]))),128))]),e("td",Qe,[h(F,{user:d},null,8,["user"])])]))),128))])])])])}}});const ct=z(Te,[["__scopeId","data-v-f2d05277"]]);export{ct as default};
