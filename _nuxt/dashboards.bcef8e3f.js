import{_ as Y}from"./nuxt-link.df6c488c.js";import{_ as I}from"./section-title.vue.a6fe2dde.js";import{_ as M}from"./loading-spinner.vue.f3b3e375.js";import{d as E,o as g,c as S,f as C,t as B,e as p,g as t,i as q,k as ee,v as se,w as x,h as P,p as te,l as ne,b as f,m as R,r as Z,n as z,s as J,q as v,u as ae,a as oe,x as re,y as H,j as N}from"./entry.d8c3daa0.js";import{d as ce,D as ie,e as le,a as L,c as ue}from"./data-grid.ca6f7250.js";import{D as de,a as pe,b as G}from"./box.ab076b1a.js";import{_ as _e}from"./_plugin-vue_export-helper.c27b6911.js";import{u as F}from"./useQuery.67bd27fb.js";import{u as Q}from"./useMutation.0937a1e9.js";import{u as O}from"./toast.d4c6a9e4.js";import"./_commonjsHelpers.23102255.js";import"./row_dragging.d0454e7a.js";import"./index.ab648286.js";import"./ui.collection_widget.edit.f359a828.js";import"./resize_observer.57c96ed3.js";import"./ui.form.675e7539.js";import"./text_box.67135b71.js";import"./ui.popup.28c204f7.js";import"./load_panel.57c43a65.js";import"./check_box.j.46b9e12f.js";import"./ui.list.edit.decorator.selection.2d64423b.js";import"./ui.menu.8ddfdf72.js";import"./ui.toolbar.89924961.js";import"./m_sortable.23c59dc8.js";import"./notify.edf537cb.js";var A=(e=>(e.column_name="components.admin.dashboards_table.column_name",e.column_actions="components.admin.dashboards_table.column_actions",e.error_loading_data="components.admin.dashboards_table.error_loading_data",e))(A||{});const me=e=>(te("data-v-3b20c510"),e=e(),ne(),e),ye={class:"container relative overflow-auto rounded-md border border-divider shadow-md min-h-[70vh]"},fe={class:"flex p-x2 h-12 items-center justify-center bg-primary sticky top-0"},be={class:"text-font-light font-medium"},he={key:0,class:"flex-1 flex items-center justify-center"},ge={key:1,class:"flex items-center justify-center h-[calc(100%-50px)]"},ve={class:"bg-error-light text-error w-full text-center p-8"},we={class:"flex items-center justify-end gap-2"},ke={key:0,class:"cursor-pointer flex items-center"},$e=me(()=>C("svg",{class:"cursor-pointer stroke-primary w-[18px] h-[18px]",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[C("path",{d:"M9 4.45962C9.91153 4.16968 10.9104 4 12 4C16.1819 4 19.028 6.49956 20.7251 8.70433C21.575 9.80853 22 10.3606 22 12C22 13.6394 21.575 14.1915 20.7251 15.2957C19.028 17.5004 16.1819 20 12 20C7.81811 20 4.97196 17.5004 3.27489 15.2957C2.42496 14.1915 2 13.6394 2 12C2 10.3606 2.42496 9.80853 3.27489 8.70433C3.75612 8.07914 4.32973 7.43025 5 6.82137","stroke-width":"1.5","stroke-linecap":"round",stroke:"#1c274c"}),C("path",{d:"M15 12C15 13.6569 13.6569 15 12 15C10.3431 15 9 13.6569 9 12C9 10.3431 10.3431 9 12 9C13.6569 9 15 10.3431 15 12Z","stroke-width":"1.5",stroke:"#1c274c"})],-1)),xe=[$e],Ce=E({__name:"dashboards-table",props:{title:{},isPending:{type:Boolean},isError:{type:Boolean},rows:{},onSelect:{type:Function},onToggle:{type:Function}},setup(e){const n=e;function s(a){n.onSelect&&a.currentSelectedRowKeys.length>0&&n.onSelect(a.currentSelectedRowKeys[0])}return(a,o)=>{const l=M;return g(),S("div",ye,[C("div",fe,[C("span",be,B(n.title),1)]),n.isPending?(g(),S("div",he,[p(l,{size:12})])):n.isError?(g(),S("div",ge,[C("span",ve,B(a.$t(t(A).error_loading_data)),1)])):q("",!0),ee(p(t(ue),{"data-source":n.rows,"key-expr":"key",onSelectionChanged:s},{actionsTemplate:x(({data:_})=>[C("div",we,[n.onSelect?(g(),S("div",ke,xe)):q("",!0),p(t(de),{value:_.value,onValueChanged:y=>n.onToggle(_.data.key,y.value)},null,8,["value","onValueChanged"])])]),default:x(()=>[n.onSelect?(g(),P(t(ce),{key:0,mode:"single"})):q("",!0),p(t(ie),{visible:n.rows.length>0},null,8,["visible"]),p(t(le),{visible:!0}),p(t(L),{"data-field":"name",caption:a.$t(t(A).column_name)},null,8,["caption"]),p(t(L),{caption:a.$t(t(A).column_actions,2),"data-field":"permission","cell-template":"actionsTemplate"},null,8,["caption"])]),_:1},8,["data-source"]),[[se,!n.isPending&&!n.isError]])])}}});const W=_e(Ce,[["__scopeId","data-v-3b20c510"]]);async function De(){const e=f(),{data:n}=await e.client.get("accounts/0/manager-panel/users/get-users");return n.map(s=>({key:[s.id],name:s.name,photo:s.photo,permission:s.permission===1}))}async function Se(e){const n=f(),{data:s}=await n.client.get(`accounts/0/manager-panel/users/${e}/briefcases`);return s.map(a=>({key:[e,a.id],name:a.name,photo:a.photo,permission:a.permission===1}))}async function Be(e,n){const s=f(),{data:a}=await s.client.get(`accounts/0/manager-panel/users/${e}/briefcases/${n}/contents`);return a.map(o=>({key:[e,n,o.id],name:o.name,photo:o.photo,permission:o.permission===1}))}async function Fe(e){const n=f(),[s]=e.key,a=e.permission?"allow-all":"deny-all",{data:o}=await n.client.post(`accounts/0/manager-panel/users/${s}/${a}`,{user_id:s});return o}async function Qe(e){const n=f(),[s,a]=e.key,o=e.permission?"allow-all":"deny-all",{data:l}=await n.client.post(`accounts/0/manager-panel/users/${s}/briefcases/${a}/${o}`,{user_id:s,briefcase_id:a});return l}async function qe(e){const n=f(),[s,a,o]=e.key,l=e.permission?"allow-single":"deny-single",{data:_}=await n.client.post(`accounts/0/manager-panel/users/${s}/briefcases/${a}/contents/${o}/${l}`,{user_id:s,briefcase_id:a,content_id:o});return _}var i=(e=>(e.title="pages.admin.dashboards.title",e.link_by_briefcases="pages.admin.dashboards.link_by_briefcases",e.link_by_users="pages.admin.dashboards.link_by_users",e.table_briefcases="pages.admin.dashboards.table_briefcases",e.table_contents="pages.admin.dashboards.table_contents",e.table_users="pages.admin.dashboards.table_users",e.briefcase_updated_allow_successfully="pages.admin.dashboards.briefcase_updated_allow_successfully",e.briefcase_updated_deny_successfully="pages.admin.dashboards.briefcase_updated_deny_successfully",e.content_updated_allow_successfully="pages.admin.dashboards.content_updated_allow_successfully",e.content_updated_deny_successfully="pages.admin.dashboards.content_updated_deny_successfully",e.user_updated_allow_successfully="pages.admin.dashboards.user_updated_allow_successfully",e.user_updated_deny_successfully="pages.admin.dashboards.user_updated_deny_successfully",e))(i||{});const Ae={class:"flex gap-4 h-full"},Ee=E({__name:"dashboards-by-users",setup(e){const n=f(),s=O(),a=R(),o=Z([]);z(J(n).profile,()=>o.value=[]);const l=v(()=>o.value[0]),_=v(()=>o.value[1]),y=[n.profile,"admin-dashboards-by-users"],h=F({queryKey:y,queryFn:De,retry:!1}),w=F({queryKey:[...y,l],queryFn:()=>Se(l.value),enabled:v(()=>l.value!==void 0),retry:!1}),k=F({queryKey:[...y,l,_],queryFn:()=>Be(l.value,_.value),enabled:v(()=>_.value!==void 0),retry:!1});function $(u){const c=[...u.key],m=u.permission;a.setQueriesData({queryKey:[...y,...c]},r=>r==null?void 0:r.map(d=>({...d,permission:m})));for(let r=c.length;r>=0;--r){c.pop();let d=!0;if(a.setQueryData([...y,...c],D=>D==null?void 0:D.map(b=>(b.key.every((V,j)=>u.key[j]===V)&&(b={...b,permission:m}),d&&(d=!b.permission),b))),m===d)break}}const K=Q({mutationFn:Fe,onSuccess(u,c){$(c),s.show(c.permission?i.user_updated_allow_successfully:i.user_updated_deny_successfully)},onError:s.error}),U=Q({mutationFn:Qe,onSuccess(u,c){$(c),s.show(c.permission?i.briefcase_updated_allow_successfully:i.briefcase_updated_deny_successfully)},onError:s.error}),T=Q({mutationFn:qe,onSuccess(u,c){$(c),s.show(c.permission?i.content_updated_allow_successfully:i.content_updated_deny_successfully)},onError:s.error});return(u,c)=>{const m=W;return g(),S("div",Ae,[p(m,{title:u.$t(t(i).table_users),"is-pending":t(h).isFetching.value,"is-error":t(h).isError.value,rows:t(h).data.value??[],"on-select":r=>o.value=r,"on-toggle":(r,d)=>t(K).mutate({key:r,permission:d})},null,8,["title","is-pending","is-error","rows","on-select","on-toggle"]),p(m,{title:u.$t(t(i).table_briefcases),"is-pending":t(w).isFetching.value,"is-error":t(w).isError.value,rows:t(w).data.value??[],"on-select":r=>o.value=r,"on-toggle":(r,d)=>t(U).mutate({key:r,permission:d})},null,8,["title","is-pending","is-error","rows","on-select","on-toggle"]),p(m,{title:u.$t(t(i).table_contents),"is-pending":t(k).isFetching.value,"is-error":t(k).isError.value,rows:t(k).data.value??[],"on-toggle":(r,d)=>t(T).mutate({key:r,permission:d})},null,8,["title","is-pending","is-error","rows","on-toggle"])])}}});async function Ke(){const e=f(),{data:n}=await e.client.get("accounts/0/manager-panel/briefcases");return n.map(s=>({key:[s.id],name:s.name,photo:s.photo,permission:s.permission===1}))}async function Ue(e){const n=f(),{data:s}=await n.client.get(`accounts/0/manager-panel/briefcases/${e}/contents`);return s.map(a=>({key:[e,a.id],name:a.name,photo:a.photo,permission:a.permission===1}))}async function Te(e,n){const s=f(),{data:a}=await s.client.get(`accounts/0/manager-panel/briefcases/${e}/contents/${n}/users`);return a.map(o=>({key:[e,n,o.id],name:o.name,photo:o.photo,permission:o.permission===1}))}async function Ve(e){const n=f(),[s]=e.key,a=e.permission?"allow-all":"deny-all",{data:o}=await n.client.post(`accounts/0/manager-panel/briefcases/${s}/${a}`,{briefcase_id:s});return o}async function je(e){const n=f(),[s,a]=e.key,o=e.permission?"allow-all":"deny-all",{data:l}=await n.client.post(`accounts/0/manager-panel/briefcases/${s}/contents/${a}/${o}`,{briefcase_id:s,content_id:a});return l}async function Ne(e){const n=f(),[s,a,o]=e.key,l=e.permission?"allow-single":"deny-single",{data:_}=await n.client.post(`accounts/0/manager-panel/briefcases/${s}/contents/${a}/users/${o}/${l}`,{briefcase_id:s,content_id:a,user_id:o});return _}const Pe={class:"flex gap-4 h-full"},Re=E({__name:"dashboards-by-briefcases",setup(e){const n=f(),s=O(),a=R(),o=Z([]);z(J(n).profile,()=>o.value=[]);const l=v(()=>o.value[0]),_=v(()=>o.value[1]),y=[n.profile,"admin-dashboards-by-briefcases"],h=F({queryKey:y,queryFn:Ke,retry:!1}),w=F({queryKey:[...y,l],queryFn:()=>Ue(l.value),enabled:v(()=>l.value!==void 0),retry:!1}),k=F({queryKey:[...y,l,_],queryFn:()=>Te(l.value,_.value),enabled:v(()=>_.value!==void 0),retry:!1});function $(u){const c=[...u.key],m=u.permission;a.setQueriesData({queryKey:[...y,...c]},r=>r==null?void 0:r.map(d=>({...d,permission:m})));for(let r=c.length;r>=0;--r){c.pop();let d=!0;if(a.setQueryData([...y,...c],D=>D==null?void 0:D.map(b=>(b.key.every((V,j)=>u.key[j]===V)&&(b={...b,permission:m}),d&&(d=!b.permission),b))),m===d)break}}const K=Q({mutationFn:Ve,onSuccess(u,c){$(c),s.show(c.permission?i.briefcase_updated_allow_successfully:i.briefcase_updated_deny_successfully)},onError:s.error}),U=Q({mutationFn:je,onSuccess(u,c){$(c),s.show(c.permission?i.content_updated_allow_successfully:i.content_updated_deny_successfully)},onError:s.error}),T=Q({mutationFn:Ne,onSuccess(u,c){$(c),s.show(c.permission?i.user_updated_allow_successfully:i.user_updated_deny_successfully)},onError:s.error});return(u,c)=>{const m=W;return g(),S("div",Pe,[p(m,{title:u.$t(t(i).table_briefcases),"is-pending":t(h).isFetching.value,"is-error":t(h).isError.value,rows:t(h).data.value??[],"on-select":r=>o.value=r,"on-toggle":(r,d)=>t(K).mutate({key:r,permission:d})},null,8,["title","is-pending","is-error","rows","on-select","on-toggle"]),p(m,{title:u.$t(t(i).table_contents),"is-pending":t(w).isFetching.value,"is-error":t(w).isError.value,rows:t(w).data.value??[],"on-select":r=>o.value=r,"on-toggle":(r,d)=>t(U).mutate({key:r,permission:d})},null,8,["title","is-pending","is-error","rows","on-select","on-toggle"]),p(m,{title:u.$t(t(i).table_users),"is-pending":t(k).isFetching.value,"is-error":t(k).isError.value,rows:t(k).data.value??[],"on-toggle":(r,d)=>t(T).mutate({key:r,permission:d})},null,8,["title","is-pending","is-error","rows","on-toggle"])])}}}),ze={class:"flex gap-2 flex-wrap text-sm font-medium border-b border-divider max-w-[300px]"},He={class:"text-font text-center text-lg font-medium"},ys=E({__name:"dashboards",setup(e){const n=R(),{t:s}=ae();oe({title:s(i.title)});const a=re(),o=v(()=>a.query.byUsers),l=v(()=>s(o.value==="true"?i.link_by_users:i.link_by_briefcases));return z(o,()=>{n.setQueryData(["admin-contents-contents"],{data:[]}),n.setQueryData(["admin-contents-users"],{data:[]}),n.setQueryData(["admin-users-briefcases"],{data:[]}),n.setQueryData(["admin-users-contents"],{data:[]})},{immediate:!0}),(_,y)=>{const h=Y,w=I,k=Ee,$=Re;return g(),S("div",null,[p(w,null,{subtitle:x(()=>[p(t(pe),{id:"parentBox",direction:"col",height:"100%",width:"100%"},{default:x(()=>[p(t(G),{"base-size":40,ratio:1},{default:x(()=>[C("ul",ze,[p(h,{to:"?",class:H(["text-center inline-block px-4 py-2 rounded-t-lg bg-background hover:filter transition-all",t(o)?"hover:brightness-90":"bg-primary text-font-light hover:brightness-125"])},{default:x(()=>[N(B(_.$t(t(i).link_by_briefcases)),1)]),_:1},8,["class"]),p(h,{to:"?byUsers=true",class:H(["text-center inline-block px-4 py-2 rounded-t-lg bg-background hover:filter transition-all",t(o)?"bg-primary text-font-light hover:brightness-125":"hover:brightness-90"])},{default:x(()=>[N(B(_.$t(t(i).link_by_users)),1)]),_:1},8,["class"])])]),_:1}),p(t(G),{"base-size":30,ratio:1},{default:x(()=>[C("div",He,B(t(l)),1)]),_:1})]),_:1})]),default:x(()=>[N(B(_.$t(t(i).title))+" ",1)]),_:1}),t(o)?(g(),P(k,{key:0})):q("",!0),t(o)?q("",!0):(g(),P($,{key:1}))])}}});export{ys as default};
