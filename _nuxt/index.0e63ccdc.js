import{_ as v}from"./section-title.vue.7a626818.js";import{d as D,u as R,a as x,H as C,x as k,b as E,o as F,c as L,e as c,w as f,g as s,j as P,t as S}from"./entry.f47474d7.js";import{C as U,D as j,a as I}from"./file-manager.45b166c7.js";import"./_commonjsHelpers.23102255.js";import"./index.94f86987.js";import"./notify.6d2dad03.js";import"./ui.form.bf59509c.js";import"./text_box.08b8e7e6.js";import"./resize_observer.3c2fa9a2.js";import"./ui.popup.81669a77.js";import"./ui.collection_widget.edit.95cdfece.js";import"./load_panel.0862d4ae.js";import"./check_box.j.64bc2370.js";import"./ui.list.edit.decorator.selection.f35f8c9c.js";import"./ui.menu.f201d4e6.js";import"./row_dragging.56a54afd.js";import"./ui.toolbar.1b55a2cc.js";import"./m_sortable.242c124b.js";var a=(i=>(i.title="pages.services.file_manager.title",i.error_fatal="pages.services.file_manager.error_fatal",i))(a||{});const Z=D({__name:"index",setup(i){const{t:n}=R();x({title:n(a.title)});const d=C(),h=k(),p=E(),_=h.query.path??"";async function m(e){try{const t=e.path,r=t.split("/").pop(),o=await p.client.get("/files/download",{params:{path:t}});return{name:r,url:o.data}}catch{throw new Error(n(a.error_fatal))}}const w=new U({async getItems(e){try{const t=await p.client.get("/files",{params:{path:e.path}}),r=[];for(const o of t.data.folders)r.push({name:o,isDirectory:!0});for(const o of t.data.files)r.push({name:o.split("/").pop(),isDirectory:!1});return r}catch{throw new Error(n(a.error_fatal))}},async downloadItems(e){if(e.length!==1)throw new Error(n(a.error_fatal));const t=await m(e[0]);try{const o=await(await fetch(t.url)).blob(),u=URL.createObjectURL(o),l=document.createElement("a");l.download=t.name,l.target="_blank",l.href=u,l.click(),URL.revokeObjectURL(u)}catch{throw new Error(n(a.error_fatal))}}});function y(e){d.push({query:{path:e.directory.path}})}async function g(e){const t=await m(e.file);open(t.url,"_blank")}function b(e){return e.slice(0,2)}return(e,t)=>{const r=v;return F(),L("div",null,[c(r,null,{default:f(()=>[P(S(e.$t(s(a).title)),1)]),_:1}),c(s(I),{"selection-mode":"single","current-path":s(_),"customize-detail-columns":b,"file-system-provider":s(w),onCurrentDirectoryChanged:y,onSelectedFileOpened:g},{default:f(()=>[c(s(j),{download:!0})]),_:1},8,["current-path","file-system-provider"])])}}});export{Z as default};
